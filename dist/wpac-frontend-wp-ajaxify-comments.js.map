{"version":3,"file":"wpac-frontend-wp-ajaxify-comments.js","mappings":";;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACuD;AACF;;AAErD;AACA;AACA;AACA;AACA;AACA,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC;;AAEA;AACA;AACA;AACA,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;AACA,SAAS,gEAAgB;AACzB;AACA;AACA,SAAS,iEAAiB;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iBAAiB,QAAQ;AACzB;AACA,gCAAgC,OAAO;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;;AAEA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAe,aAAa,EAAC;AAC7B;;;;;;;;;;;;;;AC5FA;AACA;AACA;AACA;AACA;AACA,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC;AACA,YAAY,qBAAqB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAe,iBAAiB,EAAC;AACjC;;;;;;;;;;;;;;;AClBA;AACA;AACA;AACqD;;AAErD;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA,YAAY,oBAAoB;AAChC;;AAEA;AACA;AACA;AACA;AACA,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;AACA,SAAS,gEAAgB;AACzB;AACA;AACA;AACA;AACA;AACA,iEAAe,aAAa,EAAC;AAC7B;;;;;;;;;;;;;;AClCA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA,YAAY,SAAS;AACrB;;AAEA;AACA;AACA;AACA;AACA,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC;AACA,YAAY,WAAW;AACvB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iEAAe,eAAe,EAAC;AAC/B;;;;;;;;;;;;;;AClCA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB;AACA;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;AACA,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAe,aAAa,EAAC;AAC7B;;;;;;;;;;;;;;;;;;;;;;ACjCA;AACA;AACA;AAC4C;AACM;AACN;AACA;AACQ;AACJ;AACJ;;AAE5C;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA,eAAe,mBAAmB;AAClC;AACA;;AAEA,eAAe,mBAAmB;AAClC;AACA;AACA,qBAAqB,0DAAa;AAClC,qBAAqB,0DAAa;AAClC,wBAAwB,6DAAgB;AACxC,wBAAwB,6DAAgB;AACxC,qBAAqB,0DAAa;AAClC,qBAAqB,0DAAa;AAClC,4BAA4B,6DAAgB;AAC5C,4BAA4B,6DAAgB;AAC5C,oBAAoB,0DAAa;AACjC,wBAAwB,0DAAa;AACrC,yBAAyB,8DAAiB;AAC1C,yBAAyB,8DAAiB;AAC1C,uBAAuB,4DAAe;AACtC,uBAAuB,4DAAe;AACtC,qBAAqB,0DAAa;AAClC,qBAAqB,0DAAa;AAClC;AACA;;AAEA,cAAc,QAAQ;;AAEtB;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA,iEAAe,WAAW,EAAC;AAC3B;;;;;;;;;;;;;;;;ACzDA;AACA;AACA;AACuD;AACF;;AAErD;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB;AACA;AACA,YAAY,oBAAoB;AAChC;;AAEA;AACA;AACA;AACA;AACA,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC;AACA;AACA;AACA,YAAY,YAAY;AACxB;AACA;AACA;AACA;AACA,SAAS,gEAAgB;AACzB;AACA;AACA,uBAAuB,iEAAiB;AACxC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,wCAAwC,QAAQ;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAe,gBAAgB,EAAC;AAChC;;;;;;;;;;;;;;AC9EA;AACA;AACA;AACA;AACA;AACA,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC,WAAW,sBAAsB;AACjC;AACA;AACA,YAAY,4DAA4D;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,IAAqC;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAe,aAAa,EAAC;AAC7B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvDA;AACA;AACA;AACwC;;AAExC,cAAc,uBAAuB;;AAErC;AACA;AACA,cAAc,UAAU;AACxB,cAAc,UAAU;AACxB,cAAc,UAAU;AACxB;;AAEA;AACA;AACA,cAAc,WAAW;AACzB,cAAc,WAAW;AACzB;;AAEA;AACA;AACA,cAAc,QAAQ;AACtB,cAAc,QAAQ;AACtB;;AAEA;AACA,aAAa,wBAAwB,uBAAuB;AAC5D;;AAEA;AACA,aAAa,uBAAuB;AACpC;;AAEA;AACA,aAAa,+BAA+B;AAC5C;;AAEO,qBAAqB,wDAAW;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACyP;AAC3P;;;;;;;;;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","sources":["webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/createAddHook.js","webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/createCurrentHook.js","webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/createDidHook.js","webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/createDoingHook.js","webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/createHasHook.js","webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/createHooks.js","webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/createRemoveHook.js","webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/createRunHook.js","webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/index.js","webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/validateHookName.js","webpack://wp-ajaxify-comments/./node_modules/@wordpress/hooks/build-module/validateNamespace.js","webpack://wp-ajaxify-comments/webpack/bootstrap","webpack://wp-ajaxify-comments/webpack/runtime/define property getters","webpack://wp-ajaxify-comments/webpack/runtime/hasOwnProperty shorthand","webpack://wp-ajaxify-comments/webpack/runtime/make namespace object","webpack://wp-ajaxify-comments/./src/js/frontend/wp-ajaxify-comments.js"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport validateNamespace from './validateNamespace.js';\nimport validateHookName from './validateHookName.js';\n\n/**\n * @callback AddHook\n *\n * Adds the hook to the appropriate hooks container.\n *\n * @param {string}               hookName      Name of hook to add\n * @param {string}               namespace     The unique namespace identifying the callback in the form `vendor/plugin/function`.\n * @param {import('.').Callback} callback      Function to call when the hook is run\n * @param {number}               [priority=10] Priority of this hook\n */\n\n/**\n * Returns a function which, when invoked, will add a hook.\n *\n * @param {import('.').Hooks}    hooks    Hooks instance.\n * @param {import('.').StoreKey} storeKey\n *\n * @return {AddHook} Function that adds a new hook.\n */\nfunction createAddHook(hooks, storeKey) {\n  return function addHook(hookName, namespace, callback, priority = 10) {\n    const hooksStore = hooks[storeKey];\n    if (!validateHookName(hookName)) {\n      return;\n    }\n    if (!validateNamespace(namespace)) {\n      return;\n    }\n    if ('function' !== typeof callback) {\n      // eslint-disable-next-line no-console\n      console.error('The hook callback must be a function.');\n      return;\n    }\n\n    // Validate numeric priority\n    if ('number' !== typeof priority) {\n      // eslint-disable-next-line no-console\n      console.error('If specified, the hook priority must be a number.');\n      return;\n    }\n    const handler = {\n      callback,\n      priority,\n      namespace\n    };\n    if (hooksStore[hookName]) {\n      // Find the correct insert index of the new hook.\n      const handlers = hooksStore[hookName].handlers;\n\n      /** @type {number} */\n      let i;\n      for (i = handlers.length; i > 0; i--) {\n        if (priority >= handlers[i - 1].priority) {\n          break;\n        }\n      }\n      if (i === handlers.length) {\n        // If append, operate via direct assignment.\n        handlers[i] = handler;\n      } else {\n        // Otherwise, insert before index via splice.\n        handlers.splice(i, 0, handler);\n      }\n\n      // We may also be currently executing this hook.  If the callback\n      // we're adding would come after the current callback, there's no\n      // problem; otherwise we need to increase the execution index of\n      // any other runs by 1 to account for the added element.\n      hooksStore.__current.forEach(hookInfo => {\n        if (hookInfo.name === hookName && hookInfo.currentIndex >= i) {\n          hookInfo.currentIndex++;\n        }\n      });\n    } else {\n      // This is the first hook of its type.\n      hooksStore[hookName] = {\n        handlers: [handler],\n        runs: 0\n      };\n    }\n    if (hookName !== 'hookAdded') {\n      hooks.doAction('hookAdded', hookName, namespace, callback, priority);\n    }\n  };\n}\nexport default createAddHook;\n//# sourceMappingURL=createAddHook.js.map","/**\n * Returns a function which, when invoked, will return the name of the\n * currently running hook, or `null` if no hook of the given type is currently\n * running.\n *\n * @param {import('.').Hooks}    hooks    Hooks instance.\n * @param {import('.').StoreKey} storeKey\n *\n * @return {() => string | null} Function that returns the current hook name or null.\n */\nfunction createCurrentHook(hooks, storeKey) {\n  return function currentHook() {\n    var _hooksStore$__current;\n    const hooksStore = hooks[storeKey];\n    return (_hooksStore$__current = hooksStore.__current[hooksStore.__current.length - 1]?.name) !== null && _hooksStore$__current !== void 0 ? _hooksStore$__current : null;\n  };\n}\nexport default createCurrentHook;\n//# sourceMappingURL=createCurrentHook.js.map","/**\n * Internal dependencies\n */\nimport validateHookName from './validateHookName.js';\n\n/**\n * @callback DidHook\n *\n * Returns the number of times an action has been fired.\n *\n * @param {string} hookName The hook name to check.\n *\n * @return {number | undefined} The number of times the hook has run.\n */\n\n/**\n * Returns a function which, when invoked, will return the number of times a\n * hook has been called.\n *\n * @param {import('.').Hooks}    hooks    Hooks instance.\n * @param {import('.').StoreKey} storeKey\n *\n * @return {DidHook} Function that returns a hook's call count.\n */\nfunction createDidHook(hooks, storeKey) {\n  return function didHook(hookName) {\n    const hooksStore = hooks[storeKey];\n    if (!validateHookName(hookName)) {\n      return;\n    }\n    return hooksStore[hookName] && hooksStore[hookName].runs ? hooksStore[hookName].runs : 0;\n  };\n}\nexport default createDidHook;\n//# sourceMappingURL=createDidHook.js.map","/**\n * @callback DoingHook\n * Returns whether a hook is currently being executed.\n *\n * @param {string} [hookName] The name of the hook to check for.  If\n *                            omitted, will check for any hook being executed.\n *\n * @return {boolean} Whether the hook is being executed.\n */\n\n/**\n * Returns a function which, when invoked, will return whether a hook is\n * currently being executed.\n *\n * @param {import('.').Hooks}    hooks    Hooks instance.\n * @param {import('.').StoreKey} storeKey\n *\n * @return {DoingHook} Function that returns whether a hook is currently\n *                     being executed.\n */\nfunction createDoingHook(hooks, storeKey) {\n  return function doingHook(hookName) {\n    const hooksStore = hooks[storeKey];\n\n    // If the hookName was not passed, check for any current hook.\n    if ('undefined' === typeof hookName) {\n      return 'undefined' !== typeof hooksStore.__current[0];\n    }\n\n    // Return the __current hook.\n    return hooksStore.__current[0] ? hookName === hooksStore.__current[0].name : false;\n  };\n}\nexport default createDoingHook;\n//# sourceMappingURL=createDoingHook.js.map","/**\n * @callback HasHook\n *\n * Returns whether any handlers are attached for the given hookName and optional namespace.\n *\n * @param {string} hookName    The name of the hook to check for.\n * @param {string} [namespace] Optional. The unique namespace identifying the callback\n *                             in the form `vendor/plugin/function`.\n *\n * @return {boolean} Whether there are handlers that are attached to the given hook.\n */\n/**\n * Returns a function which, when invoked, will return whether any handlers are\n * attached to a particular hook.\n *\n * @param {import('.').Hooks}    hooks    Hooks instance.\n * @param {import('.').StoreKey} storeKey\n *\n * @return {HasHook} Function that returns whether any handlers are\n *                   attached to a particular hook and optional namespace.\n */\nfunction createHasHook(hooks, storeKey) {\n  return function hasHook(hookName, namespace) {\n    const hooksStore = hooks[storeKey];\n\n    // Use the namespace if provided.\n    if ('undefined' !== typeof namespace) {\n      return hookName in hooksStore && hooksStore[hookName].handlers.some(hook => hook.namespace === namespace);\n    }\n    return hookName in hooksStore;\n  };\n}\nexport default createHasHook;\n//# sourceMappingURL=createHasHook.js.map","/**\n * Internal dependencies\n */\nimport createAddHook from './createAddHook';\nimport createRemoveHook from './createRemoveHook';\nimport createHasHook from './createHasHook';\nimport createRunHook from './createRunHook';\nimport createCurrentHook from './createCurrentHook';\nimport createDoingHook from './createDoingHook';\nimport createDidHook from './createDidHook';\n\n/**\n * Internal class for constructing hooks. Use `createHooks()` function\n *\n * Note, it is necessary to expose this class to make its type public.\n *\n * @private\n */\nexport class _Hooks {\n  constructor() {\n    /** @type {import('.').Store} actions */\n    this.actions = Object.create(null);\n    this.actions.__current = [];\n\n    /** @type {import('.').Store} filters */\n    this.filters = Object.create(null);\n    this.filters.__current = [];\n    this.addAction = createAddHook(this, 'actions');\n    this.addFilter = createAddHook(this, 'filters');\n    this.removeAction = createRemoveHook(this, 'actions');\n    this.removeFilter = createRemoveHook(this, 'filters');\n    this.hasAction = createHasHook(this, 'actions');\n    this.hasFilter = createHasHook(this, 'filters');\n    this.removeAllActions = createRemoveHook(this, 'actions', true);\n    this.removeAllFilters = createRemoveHook(this, 'filters', true);\n    this.doAction = createRunHook(this, 'actions');\n    this.applyFilters = createRunHook(this, 'filters', true);\n    this.currentAction = createCurrentHook(this, 'actions');\n    this.currentFilter = createCurrentHook(this, 'filters');\n    this.doingAction = createDoingHook(this, 'actions');\n    this.doingFilter = createDoingHook(this, 'filters');\n    this.didAction = createDidHook(this, 'actions');\n    this.didFilter = createDidHook(this, 'filters');\n  }\n}\n\n/** @typedef {_Hooks} Hooks */\n\n/**\n * Returns an instance of the hooks object.\n *\n * @return {Hooks} A Hooks instance.\n */\nfunction createHooks() {\n  return new _Hooks();\n}\nexport default createHooks;\n//# sourceMappingURL=createHooks.js.map","/**\n * Internal dependencies\n */\nimport validateNamespace from './validateNamespace.js';\nimport validateHookName from './validateHookName.js';\n\n/**\n * @callback RemoveHook\n * Removes the specified callback (or all callbacks) from the hook with a given hookName\n * and namespace.\n *\n * @param {string} hookName  The name of the hook to modify.\n * @param {string} namespace The unique namespace identifying the callback in the\n *                           form `vendor/plugin/function`.\n *\n * @return {number | undefined} The number of callbacks removed.\n */\n\n/**\n * Returns a function which, when invoked, will remove a specified hook or all\n * hooks by the given name.\n *\n * @param {import('.').Hooks}    hooks             Hooks instance.\n * @param {import('.').StoreKey} storeKey\n * @param {boolean}              [removeAll=false] Whether to remove all callbacks for a hookName,\n *                                                 without regard to namespace. Used to create\n *                                                 `removeAll*` functions.\n *\n * @return {RemoveHook} Function that removes hooks.\n */\nfunction createRemoveHook(hooks, storeKey, removeAll = false) {\n  return function removeHook(hookName, namespace) {\n    const hooksStore = hooks[storeKey];\n    if (!validateHookName(hookName)) {\n      return;\n    }\n    if (!removeAll && !validateNamespace(namespace)) {\n      return;\n    }\n\n    // Bail if no hooks exist by this name.\n    if (!hooksStore[hookName]) {\n      return 0;\n    }\n    let handlersRemoved = 0;\n    if (removeAll) {\n      handlersRemoved = hooksStore[hookName].handlers.length;\n      hooksStore[hookName] = {\n        runs: hooksStore[hookName].runs,\n        handlers: []\n      };\n    } else {\n      // Try to find the specified callback to remove.\n      const handlers = hooksStore[hookName].handlers;\n      for (let i = handlers.length - 1; i >= 0; i--) {\n        if (handlers[i].namespace === namespace) {\n          handlers.splice(i, 1);\n          handlersRemoved++;\n          // This callback may also be part of a hook that is\n          // currently executing.  If the callback we're removing\n          // comes after the current callback, there's no problem;\n          // otherwise we need to decrease the execution index of any\n          // other runs by 1 to account for the removed element.\n          hooksStore.__current.forEach(hookInfo => {\n            if (hookInfo.name === hookName && hookInfo.currentIndex >= i) {\n              hookInfo.currentIndex--;\n            }\n          });\n        }\n      }\n    }\n    if (hookName !== 'hookRemoved') {\n      hooks.doAction('hookRemoved', hookName, namespace);\n    }\n    return handlersRemoved;\n  };\n}\nexport default createRemoveHook;\n//# sourceMappingURL=createRemoveHook.js.map","/**\n * Returns a function which, when invoked, will execute all callbacks\n * registered to a hook of the specified type, optionally returning the final\n * value of the call chain.\n *\n * @param {import('.').Hooks}    hooks                  Hooks instance.\n * @param {import('.').StoreKey} storeKey\n * @param {boolean}              [returnFirstArg=false] Whether each hook callback is expected to\n *                                                      return its first argument.\n *\n * @return {(hookName:string, ...args: unknown[]) => undefined|unknown} Function that runs hook callbacks.\n */\nfunction createRunHook(hooks, storeKey, returnFirstArg = false) {\n  return function runHooks(hookName, ...args) {\n    const hooksStore = hooks[storeKey];\n    if (!hooksStore[hookName]) {\n      hooksStore[hookName] = {\n        handlers: [],\n        runs: 0\n      };\n    }\n    hooksStore[hookName].runs++;\n    const handlers = hooksStore[hookName].handlers;\n\n    // The following code is stripped from production builds.\n    if ('production' !== process.env.NODE_ENV) {\n      // Handle any 'all' hooks registered.\n      if ('hookAdded' !== hookName && hooksStore.all) {\n        handlers.push(...hooksStore.all.handlers);\n      }\n    }\n    if (!handlers || !handlers.length) {\n      return returnFirstArg ? args[0] : undefined;\n    }\n    const hookInfo = {\n      name: hookName,\n      currentIndex: 0\n    };\n    hooksStore.__current.push(hookInfo);\n    while (hookInfo.currentIndex < handlers.length) {\n      const handler = handlers[hookInfo.currentIndex];\n      const result = handler.callback.apply(null, args);\n      if (returnFirstArg) {\n        args[0] = result;\n      }\n      hookInfo.currentIndex++;\n    }\n    hooksStore.__current.pop();\n    if (returnFirstArg) {\n      return args[0];\n    }\n    return undefined;\n  };\n}\nexport default createRunHook;\n//# sourceMappingURL=createRunHook.js.map","/**\n * Internal dependencies\n */\nimport createHooks from './createHooks';\n\n/** @typedef {(...args: any[])=>any} Callback */\n\n/**\n * @typedef Handler\n * @property {Callback} callback  The callback\n * @property {string}   namespace The namespace\n * @property {number}   priority  The namespace\n */\n\n/**\n * @typedef Hook\n * @property {Handler[]} handlers Array of handlers\n * @property {number}    runs     Run counter\n */\n\n/**\n * @typedef Current\n * @property {string} name         Hook name\n * @property {number} currentIndex The index\n */\n\n/**\n * @typedef {Record<string, Hook> & {__current: Current[]}} Store\n */\n\n/**\n * @typedef {'actions' | 'filters'} StoreKey\n */\n\n/**\n * @typedef {import('./createHooks').Hooks} Hooks\n */\n\nexport const defaultHooks = createHooks();\nconst {\n  addAction,\n  addFilter,\n  removeAction,\n  removeFilter,\n  hasAction,\n  hasFilter,\n  removeAllActions,\n  removeAllFilters,\n  doAction,\n  applyFilters,\n  currentAction,\n  currentFilter,\n  doingAction,\n  doingFilter,\n  didAction,\n  didFilter,\n  actions,\n  filters\n} = defaultHooks;\nexport { createHooks, addAction, addFilter, removeAction, removeFilter, hasAction, hasFilter, removeAllActions, removeAllFilters, doAction, applyFilters, currentAction, currentFilter, doingAction, doingFilter, didAction, didFilter, actions, filters };\n//# sourceMappingURL=index.js.map","/**\n * Validate a hookName string.\n *\n * @param {string} hookName The hook name to validate. Should be a non empty string containing\n *                          only numbers, letters, dashes, periods and underscores. Also,\n *                          the hook name cannot begin with `__`.\n *\n * @return {boolean} Whether the hook name is valid.\n */\nfunction validateHookName(hookName) {\n  if ('string' !== typeof hookName || '' === hookName) {\n    // eslint-disable-next-line no-console\n    console.error('The hook name must be a non-empty string.');\n    return false;\n  }\n  if (/^__/.test(hookName)) {\n    // eslint-disable-next-line no-console\n    console.error('The hook name cannot begin with `__`.');\n    return false;\n  }\n  if (!/^[a-zA-Z][a-zA-Z0-9_.-]*$/.test(hookName)) {\n    // eslint-disable-next-line no-console\n    console.error('The hook name can only contain numbers, letters, dashes, periods and underscores.');\n    return false;\n  }\n  return true;\n}\nexport default validateHookName;\n//# sourceMappingURL=validateHookName.js.map","/**\n * Validate a namespace string.\n *\n * @param {string} namespace The namespace to validate - should take the form\n *                           `vendor/plugin/function`.\n *\n * @return {boolean} Whether the namespace is valid.\n */\nfunction validateNamespace(namespace) {\n  if ('string' !== typeof namespace || '' === namespace) {\n    // eslint-disable-next-line no-console\n    console.error('The namespace must be a non-empty string.');\n    return false;\n  }\n  if (!/^[a-zA-Z][a-zA-Z0-9_.\\-\\/]*$/.test(namespace)) {\n    // eslint-disable-next-line no-console\n    console.error('The namespace can only contain numbers, letters, dashes, periods, underscores and slashes.');\n    return false;\n  }\n  return true;\n}\nexport default validateNamespace;\n//# sourceMappingURL=validateNamespace.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { createHooks } from '@wordpress/hooks';\r\n\r\nconst wpacHooks = createHooks();\r\n\r\nWPAC._Options = WPAC._Options || {};\r\n\r\nWPAC._BodyRegex = new RegExp( '<body[^>]*>((.|\\n|\\r)*)</body>', 'i' );\r\nWPAC._ExtractBody = function( html ) {\r\n\ttry {\r\n\t\treturn jQuery( '<div>' + WPAC._BodyRegex.exec( html )[ 1 ] + '</div>' );\r\n\t} catch ( e ) {\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\nWPAC._TitleRegex = new RegExp( '<title[^>]*>(.*?)<\\\\/title>', 'im' );\r\nWPAC._ExtractTitle = function( html ) {\r\n\ttry {\r\n\t\treturn WPAC._TitleRegex.exec( html )[ 1 ];\r\n\t} catch ( e ) {\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\nWPAC._ShowMessage = function( message, type ) {\r\n\t// Determine how to display the loading message.\r\n\tconst lazyLoadDisplay = WPAC._Options.lazyLoadDisplay;\r\n\tconst lazyLoadEnabled = WPAC._Options.lazyLoadEnabled;\r\n\r\n\t// Check if lazy load enabled or not.\r\n\tif ( lazyLoadEnabled && 'overlay' !== lazyLoadDisplay ) {\r\n\t\treturn;\r\n\t}\r\n\tconst top =\r\n\t\tWPAC._Options.popupMarginTop + ( jQuery( '#wpadminbar' ).outerHeight() || 0 );\r\n\r\n\tlet backgroundColor = WPAC._Options.popupBackgroundColorLoading;\r\n\tlet textColor = WPAC._Options.popupTextColorLoading;\r\n\tif ( type == 'error' ) {\r\n\t\tbackgroundColor = WPAC._Options.popupBackgroundColorError;\r\n\t\ttextColor = WPAC._Options.popupTextColorError;\r\n\t} else if ( type == 'success' ) {\r\n\t\tbackgroundColor = WPAC._Options.popupBackgroundColorSuccess;\r\n\t\ttextColor = WPAC._Options.popupTextColorSuccess;\r\n\t}\r\n\r\n\tjQuery.blockUI( {\r\n\t\tmessage,\r\n\t\tfadeIn: WPAC._Options.popupFadeIn,\r\n\t\tfadeOut: WPAC._Options.popupFadeOut,\r\n\t\ttimeout: type == 'loading' ? 0 : WPAC._Options.popupTimeout,\r\n\t\tcenterY: false,\r\n\t\tcenterX: true,\r\n\t\tshowOverlay: type == 'loading' || type == 'loadingPreview',\r\n\t\tcss: {\r\n\t\t\twidth: WPAC._Options.popupWidth + '%',\r\n\t\t\tleft: ( 100 - WPAC._Options.popupWidth ) / 2 + '%',\r\n\t\t\ttop: top + 'px',\r\n\t\t\tborder: 'none',\r\n\t\t\tpadding: WPAC._Options.popupPadding + 'px',\r\n\t\t\tbackgroundColor,\r\n\t\t\t'-webkit-border-radius': WPAC._Options.popupCornerRadius + 'px',\r\n\t\t\t'-moz-border-radius': WPAC._Options.popupCornerRadius + 'px',\r\n\t\t\t'border-radius': WPAC._Options.popupCornerRadius + 'px',\r\n\t\t\topacity: WPAC._Options.popupOpacity / 100,\r\n\t\t\tcolor: textColor,\r\n\t\t\ttextAlign: WPAC._Options.popupTextAlign,\r\n\t\t\tcursor:\r\n\t\t\t\ttype == 'loading' || type == 'loadingPreview' ? 'wait' : 'default',\r\n\t\t\t'font-size': WPAC._Options.popupTextFontSize,\r\n\t\t},\r\n\t\toverlayCSS: {\r\n\t\t\tbackgroundColor: '#000',\r\n\t\t\topacity: 0,\r\n\t\t},\r\n\t\tbaseZ: WPAC._Options.popupZindex,\r\n\t} );\r\n};\r\n\r\nWPAC._DebugErrorShown = false;\r\nWPAC._Debug = function( level, message ) {\r\n\tif ( ! WPAC._Options.debug ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Fix console.log.apply for IE9\r\n\t// see http://stackoverflow.com/a/5539378/516472\r\n\tif (\r\n\t\tFunction.prototype.call &&\r\n\t\tFunction.prototype.call.bind &&\r\n\t\ttypeof window.console !== 'undefined' &&\r\n\t\tconsole &&\r\n\t\ttypeof console.log === 'object' &&\r\n\t\ttypeof window.console[ level ].apply === 'undefined'\r\n\t) {\r\n\t\tconsole[ level ] = Function.prototype.call.bind( console[ level ], console );\r\n\t}\r\n\r\n\tif (\r\n\t\ttypeof window.console === 'undefined' ||\r\n\t\ttypeof window.console[ level ] === 'undefined' ||\r\n\t\ttypeof window.console[ level ].apply === 'undefined'\r\n\t) {\r\n\t\tif ( ! WPAC._DebugErrorShown ) {\r\n\t\t\talert(\r\n\t\t\t\t'Unfortunately the console object is undefined or is not supported in your browser, debugging WP Ajaxify Comments is disabled! Please use Firebug, Google Chrome or Internet Explorer 9 or above with enabled Developer Tools (F12) for debugging WP Ajaxify Comments.',\r\n\t\t\t);\r\n\t\t}\r\n\t\tWPAC._DebugErrorShown = true;\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst args = jQuery.merge(\r\n\t\t[ '[WP Ajaxify Comments] ' + message ],\r\n\t\tjQuery.makeArray( arguments ).slice( 2 ),\r\n\t);\r\n\tconsole[ level ].apply( console, args );\r\n};\r\n\r\nWPAC._DebugSelector = function( elementType, selector, optional ) {\r\n\tif ( ! WPAC._Options.debug ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst element = jQuery( selector );\r\n\tif ( ! element.length ) {\r\n\t\tWPAC._Debug(\r\n\t\t\toptional ? 'info' : 'error',\r\n\t\t\t\"Search %s (selector: '%s')... Not found\",\r\n\t\t\telementType,\r\n\t\t\tselector,\r\n\t\t);\r\n\t} else {\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t\"Search %s (selector: '%s')... Found: %o\",\r\n\t\t\telementType,\r\n\t\t\tselector,\r\n\t\t\telement,\r\n\t\t);\r\n\t}\r\n};\r\n\r\nWPAC._AddQueryParamStringToUrl = function( url, param, value ) {\r\n\t// Get URL object.\r\n\tconst urlObject = new URL( url );\r\n\r\n\t// Get query params.\r\n\tconst queryParams = urlObject.searchParams;\r\n\r\n\t// Set query param.\r\n\tqueryParams.set( param, value );\r\n\r\n\t// Set query params.\r\n\turlObject.search = queryParams.toString();\r\n\r\n\t// Return URL.\r\n\treturn urlObject.toString();\r\n};\r\n\r\nWPAC._LoadFallbackUrl = function( fallbackUrl ) {\r\n\tWPAC._ShowMessage( WPAC._Options.textReloadPage, 'loading' );\r\n\r\n\tconst url = WPAC._AddQueryParamStringToUrl(\r\n\t\tfallbackUrl,\r\n\t\t'WPACRandom',\r\n\t\tnew Date().getTime(),\r\n\t);\r\n\tWPAC._Debug(\r\n\t\t'info',\r\n\t\t\"Something went wrong. Reloading page (URL: '%s')...\",\r\n\t\turl,\r\n\t);\r\n\r\n\tconst reload = function() {\r\n\t\tlocation.href = url;\r\n\t};\r\n\tif ( ! WPAC._Options.debug ) {\r\n\t\treload();\r\n\t} else {\r\n\t\tWPAC._Debug( 'info', 'Sleep for 5s to enable analyzing debug messages...' );\r\n\t\twindow.setTimeout( reload, 5000 );\r\n\t}\r\n};\r\n\r\nWPAC._ScrollToAnchor = function( anchor, updateHash, scrollComplete ) {\r\n\tscrollComplete = scrollComplete || function() { };\r\n\tconst anchorElement = jQuery( anchor );\r\n\tif ( anchorElement.length ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t'Scroll to anchor element %o (scroll speed: %s ms)...',\r\n\t\t\tanchorElement,\r\n\t\t\tWPAC._Options.scrollSpeed,\r\n\t\t);\r\n\t\tconst animateComplete = function() {\r\n\t\t\tif ( updateHash ) {\r\n\t\t\t\twindow.location.hash = anchor;\r\n\t\t\t}\r\n\t\t\tscrollComplete();\r\n\t\t};\r\n\t\tconst scrollTargetTopOffset = anchorElement.offset().top;\r\n\t\tif ( jQuery( window ).scrollTop() == scrollTargetTopOffset ) {\r\n\t\t\tanimateComplete();\r\n\t\t} else {\r\n\t\t\tjQuery( 'html,body' ).animate(\r\n\t\t\t\t{ scrollTop: scrollTargetTopOffset },\r\n\t\t\t\t{\r\n\t\t\t\t\tduration: WPAC._Options.scrollSpeed,\r\n\t\t\t\t\tcomplete: animateComplete,\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tWPAC._Debug( 'error', \"Anchor element not found (selector: '%s')\", anchor );\r\n\treturn false;\r\n};\r\n\r\nWPAC._UpdateUrl = function( url ) {\r\n\tif ( url.split( '#' )[ 0 ] == window.location.href.split( '#' )[ 0 ] ) {\r\n\t\treturn;\r\n\t}\r\n\tif ( window.history.replaceState ) {\r\n\t\twindow.history.replaceState( {}, window.document.title, url );\r\n\t} else {\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t'Browser does not support window.history.replaceState() to update the URL without reloading the page',\r\n\t\t\tanchor,\r\n\t\t);\r\n\t}\r\n};\r\n\r\nWPAC._ReplaceComments = function(\r\n\tdata,\r\n\tcommentUrl,\r\n\tuseFallbackUrl,\r\n\tformData,\r\n\tformFocus,\r\n\tselectorCommentsContainer,\r\n\tselectorCommentForm,\r\n\tselectorRespondContainer,\r\n\tbeforeSelectElements,\r\n\tbeforeUpdateComments,\r\n\tafterUpdateComments,\r\n) {\r\n\tconst fallbackUrl = useFallbackUrl\r\n\t\t? WPAC._AddQueryParamStringToUrl( commentUrl, 'WPACFallback', '1' )\r\n\t\t: commentUrl;\r\n\r\n\tlet oldCommentsContainer = jQuery( selectorCommentsContainer );\r\n\tif ( ! oldCommentsContainer.length ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Comment container on current page not found (selector: '%s')\",\r\n\t\t\tselectorCommentsContainer,\r\n\t\t);\r\n\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\treturn false;\r\n\t}\r\n\t// If length is greater than one, there may be greedy selectors.\r\n\tif ( oldCommentsContainer.length > 1 ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Comment form on requested page found multiple times (selector: '%s')\",\r\n\t\t\toldCommentsContainer,\r\n\t\t);\r\n\t\toldCommentsContainer = oldCommentsContainer.filter( function() {\r\n\t\t\treturn jQuery( this ).children().length > 0 && ! jQuery( this ).is( ':header' );\r\n\t\t} );\r\n\t}\r\n\r\n\tconst extractedBody = WPAC._ExtractBody( data );\r\n\tif ( extractedBody === false ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Unsupported server response, unable to extract body (data: '%s')\",\r\n\t\t\tdata,\r\n\t\t);\r\n\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Call before select elements.\r\n\tif ( beforeSelectElements !== '' ) {\r\n\t\tconst beforeSelect = new Function( 'extractedBody', beforeSelectElements );\r\n\t\tbeforeSelect( extractedBody );\r\n\r\n\t\t// Set up custom event.\r\n\t\tconst beforeSelectEvent = new CustomEvent( 'wpacBeforeSelectElements', {\r\n\t\t\tdetail: { extractedBody },\r\n\t\t} );\r\n\t\tdocument.dispatchEvent( beforeSelectEvent );\r\n\t}\r\n\r\n\tlet newCommentsContainer = extractedBody.find( selectorCommentsContainer );\r\n\tif ( ! newCommentsContainer.length ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Comment container on requested page not found (selector: '%s')\",\r\n\t\t\tselectorCommentsContainer,\r\n\t\t);\r\n\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\treturn false;\r\n\t}\r\n\tif ( newCommentsContainer.length > 1 ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Comment form on requested page found multiple times (selector: '%s')\",\r\n\t\t\tnewCommentsContainer,\r\n\t\t);\r\n\r\n\t\t// Find the first comment container that has children and is not a heading.\r\n\t\tnewCommentsContainer = newCommentsContainer.filter( function() {\r\n\t\t\treturn jQuery( this ).children().length > 0 && ! jQuery( this ).is( ':header' );\r\n\t\t} );\r\n\t}\r\n\r\n\t// Call before update comments.\r\n\tif ( '' !== beforeUpdateComments ) {\r\n\t\tconst beforeComments = new Function(\r\n\t\t\t'extractedBody',\r\n\t\t\t'commentUrl',\r\n\t\t\tbeforeUpdateComments,\r\n\t\t);\r\n\t\tbeforeComments( extractedBody, commentUrl );\r\n\r\n\t\t// Set up native event handler.\r\n\t\tconst beforeCommentsEvent = new CustomEvent( 'wpacBeforeUpdateComments', {\r\n\t\t\tdetail: { newDom: extractedBody, commentUrl },\r\n\t\t} );\r\n\t\tdocument.dispatchEvent( beforeCommentsEvent );\r\n\t}\r\n\r\n\t// Update title\r\n\tconst extractedTitle = WPAC._ExtractTitle( data );\r\n\tif ( extractedBody !== false ) {\r\n\t\t// Decode HTML entities (see http://stackoverflow.com/a/5796744)\r\n\t\tdocument.title = jQuery( '<textarea />' ).html( extractedTitle ).text();\r\n\t}\r\n\r\n\t// Update comments container\r\n\toldCommentsContainer.replaceWith( newCommentsContainer );\r\n\r\n\tif ( WPAC._Options.commentsEnabled ) {\r\n\t\tconst form = jQuery( selectorCommentForm );\r\n\t\tif ( form.length ) {\r\n\t\t\t// Replace comment form (for spam protection plugin compatibility) if comment form is not nested in comments container\r\n\t\t\t// If comment form is nested in comments container comment form has already been replaced\r\n\t\t\tif ( ! form.parents( selectorCommentsContainer ).length ) {\r\n\t\t\t\tWPAC._Debug( 'info', 'Replace comment form...' );\r\n\t\t\t\tconst newCommentForm = extractedBody.find( selectorCommentForm );\r\n\t\t\t\tif ( newCommentForm.length == 0 ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'error',\r\n\t\t\t\t\t\t\"Comment form on requested page not found (selector: '%s')\",\r\n\t\t\t\t\t\tselectorCommentForm,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tform.replaceWith( newCommentForm );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tWPAC._Debug( 'info', 'Try to re-inject comment form...' );\r\n\r\n\t\t\t// \"Re-inject\" comment form, if comment form was removed by updating the comments container; could happen\r\n\t\t\t// if theme support threaded/nested comments and form tag is not nested in comments container\r\n\t\t\t// -> Replace WordPress placeholder <div> (#wp-temp-form-div) with respond <div>\r\n\t\t\tconst wpTempFormDiv = jQuery( '#wp-temp-form-div' );\r\n\t\t\tif ( ! wpTempFormDiv.length ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'error',\r\n\t\t\t\t\t\"WordPress' #wp-temp-form-div container not found\",\r\n\t\t\t\t\tselectorRespondContainer,\r\n\t\t\t\t);\r\n\t\t\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tconst newRespondContainer = extractedBody.find( selectorRespondContainer );\r\n\t\t\tif ( ! newRespondContainer.length ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'error',\r\n\t\t\t\t\t\"Respond container on requested page not found (selector: '%s')\",\r\n\t\t\t\t\tselectorRespondContainer,\r\n\t\t\t\t);\r\n\t\t\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\twpTempFormDiv.replaceWith( newRespondContainer );\r\n\t\t}\r\n\r\n\t\tif ( formData ) {\r\n\t\t\t// Re-inject saved form data\r\n\t\t\tjQuery.each( formData, function( key, value ) {\r\n\t\t\t\tconst formElement = jQuery(\r\n\t\t\t\t\t\"[name='\" + value.name + \"']\",\r\n\t\t\t\t\tselectorCommentForm,\r\n\t\t\t\t);\r\n\t\t\t\tif ( formElement.length != 1 || formElement.val() ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tformElement.val( value.value );\r\n\t\t\t} );\r\n\t\t}\r\n\t\tif ( formFocus ) {\r\n\t\t\t// Reset focus\r\n\t\t\tconst formElement = jQuery(\r\n\t\t\t\t\"[name='\" + formFocus + \"']\",\r\n\t\t\t\tselectorCommentForm,\r\n\t\t\t);\r\n\t\t\tif ( formElement ) {\r\n\t\t\t\tformElement.focus();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Call after update comments.\r\n\tif ( '' !== afterUpdateComments ) {\r\n\t\tconst updateComments = new Function(\r\n\t\t\t'extractedBody',\r\n\t\t\t'commentUrl',\r\n\t\t\tafterUpdateComments,\r\n\t\t);\r\n\t\tupdateComments( extractedBody, commentUrl );\r\n\r\n\t\t// Set up native event handler.\r\n\t\tconst updateCommentsEvent = new CustomEvent( 'wpacAfterUpdateComments', {\r\n\t\t\tdetail: { newDom: extractedBody, commentUrl },\r\n\t\t} );\r\n\t\tdocument.dispatchEvent( updateCommentsEvent );\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\nWPAC._TestCrossDomainScripting = function( url ) {\r\n\tif ( url.indexOf( 'http' ) != 0 ) {\r\n\t\treturn false;\r\n\t}\r\n\tconst domain = window.location.protocol + '//' + window.location.host;\r\n\treturn url.indexOf( domain ) != 0;\r\n};\r\n\r\nWPAC._TestFallbackUrl = function( url ) {\r\n\t// Get URL object.\r\n\tconst urlObject = new URL( url );\r\n\r\n\t// Get query params.\r\n\tconst queryParams = urlObject.searchParams;\r\n\tconst fallbackParam = queryParams.get( 'WPACFallback' );\r\n\tconst randomParam = queryParams.get( 'WPACRandom' );\r\n\r\n\treturn fallbackParam && randomParam;\r\n};\r\n\r\nWPAC.AttachForm = function( options ) {\r\n\t// Set default options\r\n\toptions = jQuery.extend(\r\n\t\t{\r\n\t\t\tselectorCommentForm: WPAC._Options.selectorCommentForm,\r\n\t\t\tselectorCommentPagingLinks: WPAC._Options.selectorCommentPagingLinks,\r\n\t\t\tbeforeSelectElements: WPACCallbacks.beforeSelectElements,\r\n\t\t\tbeforeSubmitComment: WPACCallbacks.beforeSubmitComment,\r\n\t\t\tafterPostComment: WPACCallbacks.afterPostComment,\r\n\t\t\tselectorCommentsContainer: WPAC._Options.selectorCommentsContainer,\r\n\t\t\tselectorRespondContainer: WPAC._Options.selectorRespondContainer,\r\n\t\t\tbeforeUpdateComments: WPACCallbacks.beforeUpdateComments,\r\n\t\t\tafterUpdateComments: WPACCallbacks.afterUpdateComments,\r\n\t\t\tscrollToAnchor: ! WPAC._Options.disableScrollToAnchor,\r\n\t\t\tupdateUrl: ! WPAC._Options.disableUrlUpdate,\r\n\t\t\tselectorCommentLinks: WPAC._Options.selectorCommentLinks,\r\n\t\t},\r\n\t\toptions || {},\r\n\t);\r\n\r\n\t/**\r\n\t * Filter the options for Ajaxify Comments.\r\n\t *\r\n\t * @param { Object } options Options for Ajaxify Comments.\r\n\t * @param { string } url     The URL to load.\r\n\t * @param { string } caller  What function called the filter.\r\n\t */\r\n\toptions = wpacHooks.applyFilters( 'wpacJSOptions', options, '', 'AttachForm' );\r\n\r\n\tif ( WPAC._Options.debug && WPAC._Options.commentsEnabled ) {\r\n\t\tWPAC._Debug( 'info', 'Attach form...' );\r\n\t\tWPAC._DebugSelector( 'comment form', options.selectorCommentForm );\r\n\t\tWPAC._DebugSelector(\r\n\t\t\t'comments container',\r\n\t\t\toptions.selectorCommentsContainer,\r\n\t\t);\r\n\t\tWPAC._DebugSelector( 'respond container', options.selectorRespondContainer );\r\n\t\tWPAC._DebugSelector(\r\n\t\t\t'comment paging links',\r\n\t\t\toptions.selectorCommentPagingLinks,\r\n\t\t\ttrue,\r\n\t\t);\r\n\t\tWPAC._DebugSelector( 'comment links', options.selectorCommentLinks, true );\r\n\t}\r\n\r\n\t// Try before submit comment. Using new function is not ideal here, but safer than exec.\r\n\tif ( '' !== WPACCallbacks.beforeSelectElements ) {\r\n\t\tconst beforeSelect = new Function(\r\n\t\t\t'dom',\r\n\t\t\tWPACCallbacks.beforeSelectElements,\r\n\t\t);\r\n\t\tbeforeSelect( jQuery( document ) );\r\n\r\n\t\t// Set up native event handler.\r\n\t\tconst beforeSelectEvent = new CustomEvent( 'wpacBeforeSelectElements', {\r\n\t\t\tdetail: { dom: jQuery( document ) },\r\n\t\t} );\r\n\t\tdocument.dispatchEvent( beforeSelectEvent );\r\n\t}\r\n\r\n\t// Get addHandler method\r\n\tif ( jQuery( document ).on ) {\r\n\t\t// jQuery 1.7+\r\n\t\tvar addHandler = function( event, selector, handler ) {\r\n\t\t\tjQuery( document ).on( event, selector, handler );\r\n\t\t};\r\n\t} else if ( jQuery( document ).delegate ) {\r\n\t\t// jQuery 1.4.3+\r\n\t\tvar addHandler = function( event, selector, handler ) {\r\n\t\t\tjQuery( document ).delegate( selector, event, handler );\r\n\t\t};\r\n\t} else {\r\n\t\t// jQuery 1.3+\r\n\t\tvar addHandler = function( event, selector, handler ) {\r\n\t\t\tjQuery( selector ).live( event, handler );\r\n\t\t};\r\n\t}\r\n\r\n\t// Handle paging link clicks\r\n\tconst pagingClickHandler = function( event ) {\r\n\t\tconst href = jQuery( this ).attr( 'href' );\r\n\t\tif ( href ) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tWPAC.LoadComments( href, {\r\n\t\t\t\tselectorCommentForm: options.selectorCommentForm,\r\n\t\t\t\tselectorCommentsContainer: options.selectorCommentsContainer,\r\n\t\t\t\tselectorRespondContainer: options.selectorRespondContainer,\r\n\t\t\t\tbeforeSelectElements: options.beforeSelectElements,\r\n\t\t\t\tbeforeUpdateComments: options.beforeUpdateComments,\r\n\t\t\t\tafterUpdateComments: options.afterUpdateComments,\r\n\t\t\t} );\r\n\t\t}\r\n\t};\r\n\taddHandler( 'click', options.selectorCommentPagingLinks, pagingClickHandler );\r\n\r\n\t// Handle comment link clicks\r\n\tconst linkClickHandler = function( event ) {\r\n\t\tconst element = jQuery( this );\r\n\t\tif ( element.is( options.selectorCommentPagingLinks ) ) {\r\n\t\t\treturn;\r\n\t\t} // skip if paging link was clicked\r\n\t\tconst href = element.attr( 'href' );\r\n\t\tconst anchor = '#' + new Uri( href ).anchor();\r\n\t\tif ( jQuery( anchor ).length > 0 ) {\r\n\t\t\tif ( options.updateUrl ) {\r\n\t\t\t\tWPAC._UpdateUrl( href );\r\n\t\t\t}\r\n\t\t\tWPAC._ScrollToAnchor( anchor, options.updateUrl );\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t};\r\n\taddHandler( 'click', options.selectorCommentLinks, linkClickHandler );\r\n\r\n\tif ( ! WPAC._Options.commentsEnabled ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Handle form submit\r\n\tconst formSubmitHandler = function( event ) {\r\n\t\tconst form = jQuery( this );\r\n\r\n\t\t// Try before submit comment. Using new function is not ideal here, but safer than exec.\r\n\t\tif ( WPACCallbacks.beforeSubmitComment !== '' ) {\r\n\t\t\tconst beforeSubmit = new Function(\r\n\t\t\t\t'dom',\r\n\t\t\t\tWPACCallbacks.beforeSubmitComment,\r\n\t\t\t);\r\n\t\t\tbeforeSubmit( jQuery( document ) );\r\n\r\n\t\t\t// Set up native event handler.\r\n\t\t\tconst beforeSubmitEvent = new CustomEvent( 'wpacBeforeSubmitComment', {\r\n\t\t\t\tdetail: { dom: jQuery( document ) },\r\n\t\t\t} );\r\n\t\t\tdocument.dispatchEvent( beforeSubmitEvent );\r\n\t\t}\r\n\r\n\t\tconst submitUrl = form.attr( 'action' );\r\n\r\n\t\t// Cancel AJAX request if cross-domain scripting is detected\r\n\t\tif ( WPAC._TestCrossDomainScripting( submitUrl ) ) {\r\n\t\t\tif ( WPAC._Options.debug && ! form.data( 'submitCrossDomain' ) ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'error',\r\n\t\t\t\t\t\"Cross-domain scripting detected (submit url: '%s'), cancel AJAX request\",\r\n\t\t\t\t\tsubmitUrl,\r\n\t\t\t\t);\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t'Sleep for 5s to enable analyzing debug messages...',\r\n\t\t\t\t);\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tform.data( 'submitCrossDomain', true );\r\n\t\t\t\twindow.setTimeout( function() {\r\n\t\t\t\t\tjQuery( '#submit', form ).remove();\r\n\t\t\t\t\tform.submit();\r\n\t\t\t\t}, 5000 );\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Stop default event handling\r\n\t\tevent.preventDefault();\r\n\r\n\t\t// Test if form is already submitting\r\n\t\tif ( form.data( 'WPAC_SUBMITTING' ) ) {\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'info',\r\n\t\t\t\t'Cancel submit, form is already submitting (Form: %o)',\r\n\t\t\t\tform,\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tform.data( 'WPAC_SUBMITTING', true );\r\n\r\n\t\t// Show loading info\r\n\t\tWPAC._ShowMessage( WPAC._Options.textPostComment, 'loading' );\r\n\r\n\t\tconst handleErrorResponse = function( data ) {\r\n\t\t\tWPAC._Debug( 'info', 'Comment has not been posted' );\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'info',\r\n\t\t\t\t\"Try to extract error message (selector: '%s')...\",\r\n\t\t\t\tWPAC._Options.selectorErrorContainer,\r\n\t\t\t);\r\n\r\n\t\t\t// Extract error message\r\n\t\t\tconst extractedBody = WPAC._ExtractBody( data );\r\n\t\t\tif ( extractedBody !== false ) {\r\n\t\t\t\tlet errorMessage = extractedBody.find(\r\n\t\t\t\t\tWPAC._Options.selectorErrorContainer,\r\n\t\t\t\t);\r\n\t\t\t\tif ( errorMessage.length ) {\r\n\t\t\t\t\terrorMessage = errorMessage.html();\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t\"Error message '%s' successfully extracted\",\r\n\t\t\t\t\t\terrorMessage,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tWPAC._ShowMessage( errorMessage, 'error' );\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'error',\r\n\t\t\t\t\"Error message could not be extracted, use error message '%s'.\",\r\n\t\t\t\tWPAC._Options.textUnknownError,\r\n\t\t\t);\r\n\t\t\tWPAC._ShowMessage( WPAC._Options.textUnknownError, 'error' );\r\n\t\t};\r\n\r\n\t\tvar request = jQuery.ajax( {\r\n\t\t\turl: submitUrl,\r\n\t\t\ttype: 'POST',\r\n\t\t\tdata: form.serialize(),\r\n\t\t\tbeforeSend( xhr ) {\r\n\t\t\t\txhr.setRequestHeader( 'X-WPAC-REQUEST', '1' );\r\n\t\t\t},\r\n\t\t\tcomplete( xhr, textStatus ) {\r\n\t\t\t\tform.removeData( 'WPAC_SUBMITTING', true );\r\n\t\t\t},\r\n\t\t\tsuccess( data ) {\r\n\t\t\t\t// Test error state (WordPress >=4.1 does not return 500 status code if posting comment failed)\r\n\t\t\t\tif ( request.getResponseHeader( 'X-WPAC-ERROR' ) ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t'Found error state X-WPAC-ERROR header.',\r\n\t\t\t\t\t\tcommentUrl,\r\n\t\t\t\t\t);\r\n\t\t\t\t\thandleErrorResponse( data );\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tWPAC._Debug( 'info', 'Comment has been posted' );\r\n\r\n\t\t\t\t// Get info from response header\r\n\t\t\t\tvar commentUrl = request.getResponseHeader( 'X-WPAC-URL' );\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t\"Found comment URL '%s' in X-WPAC-URL header.\",\r\n\t\t\t\t\tcommentUrl,\r\n\t\t\t\t);\r\n\t\t\t\tconst unapproved = request.getResponseHeader( 'X-WPAC-UNAPPROVED' );\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t\"Found unapproved state '%s' in X-WPAC-UNAPPROVED\",\r\n\t\t\t\t\tunapproved,\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Try afterPostComment submit comment. Using new function is not ideal here, but safer than exec.\r\n\t\t\t\tif ( WPACCallbacks.afterPostComment !== '' ) {\r\n\t\t\t\t\tconst afterComment = new Function(\r\n\t\t\t\t\t\t'commentUrl',\r\n\t\t\t\t\t\t'unapproved',\r\n\t\t\t\t\t\tafterPostComment,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tafterComment( commentUrl, unapproved == '1' );\r\n\r\n\t\t\t\t\t// Set up native event handler.\r\n\t\t\t\t\tconst afterCommentEvent = new CustomEvent( 'wpacAfterPostComment', {\r\n\t\t\t\t\t\tdetail: { commentUrl, unapproved: unapproved == '1' },\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tdocument.dispatchEvent( afterCommentEvent );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Show success message\r\n\t\t\t\tWPAC._ShowMessage(\r\n\t\t\t\t\tunapproved == '1'\r\n\t\t\t\t\t\t? WPAC._Options.textPostedUnapproved\r\n\t\t\t\t\t\t: WPAC._Options.textPosted,\r\n\t\t\t\t\t'success',\r\n\t\t\t\t);\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * Sunshine Confetti Plugin integration.\r\n\t\t\t\t *\r\n\t\t\t\t * @since 3.0.0\r\n\t\t\t\t *\r\n\t\t\t\t * @see https://wordpress.org/plugins/confetti/\r\n\t\t\t\t */\r\n\t\t\t\tif ( typeof window.wps_launch_confetti_cannon !== 'undefined' ) {\r\n\t\t\t\t\twindow.wps_launch_confetti_cannon();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Replace comments (and return if replacing failed)\r\n\t\t\t\tif (\r\n\t\t\t\t\t! WPAC._ReplaceComments(\r\n\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\tcommentUrl,\r\n\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\t{},\r\n\t\t\t\t\t\t'',\r\n\t\t\t\t\t\toptions.selectorCommentsContainer,\r\n\t\t\t\t\t\toptions.selectorCommentForm,\r\n\t\t\t\t\t\toptions.selectorRespondContainer,\r\n\t\t\t\t\t\toptions.beforeSelectElements,\r\n\t\t\t\t\t\toptions.beforeUpdateComments,\r\n\t\t\t\t\t\toptions.afterUpdateComments,\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Smooth scroll to comment url and update browser url\r\n\t\t\t\tif ( commentUrl ) {\r\n\t\t\t\t\tif ( options.updateUrl ) {\r\n\t\t\t\t\t\tWPAC._UpdateUrl( commentUrl );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( options.scrollToAnchor ) {\r\n\t\t\t\t\t\tconst anchor =\r\n\t\t\t\t\t\t\tcommentUrl.indexOf( '#' ) >= 0\r\n\t\t\t\t\t\t\t\t? commentUrl.substr( commentUrl.indexOf( '#' ) )\r\n\t\t\t\t\t\t\t\t: null;\r\n\t\t\t\t\t\tif ( anchor ) {\r\n\t\t\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t\t\t\"Anchor '%s' extracted from comment URL '%s'\",\r\n\t\t\t\t\t\t\t\tanchor,\r\n\t\t\t\t\t\t\t\tcommentUrl,\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tWPAC._ScrollToAnchor( anchor, options.updateUrl );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror( jqXhr, textStatus, errorThrown ) {\r\n\t\t\t\t// Test if loading comment url failed (due to cross site scripting error)\r\n\t\t\t\tif ( jqXhr.status === 0 && jqXhr.responseText === '' ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'error',\r\n\t\t\t\t\t\t'Comment seems to be posted, but loading comment update failed.',\r\n\t\t\t\t\t);\r\n\t\t\t\t\tWPAC._LoadFallbackUrl(\r\n\t\t\t\t\t\tWPAC._AddQueryParamStringToUrl(\r\n\t\t\t\t\t\t\twindow.location.href,\r\n\t\t\t\t\t\t\t'WPACFallback',\r\n\t\t\t\t\t\t\t'1',\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\thandleErrorResponse( jqXhr.responseText );\r\n\t\t\t},\r\n\t\t} );\r\n\t};\r\n\taddHandler( 'submit', options.selectorCommentForm, formSubmitHandler );\r\n};\r\n\r\nWPAC._Initialized = false;\r\nWPAC.Init = function() {\r\n\t// Test if plugin already has been initialized\r\n\tif ( WPAC._Initialized ) {\r\n\t\tWPAC._Debug( 'info', 'Abort initialization (plugin already initialized)' );\r\n\t\treturn false;\r\n\t}\r\n\tWPAC._Initialized = true;\r\n\r\n\t// Assert that environment is set up correctly\r\n\tif ( ! WPAC._Options || ! WPACCallbacks ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t'Something unexpected happened, initialization failed. Please try to reinstall the plugin.',\r\n\t\t);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Debug infos\r\n\tWPAC._Debug( 'info', 'Initializing version %s', WPAC._Options.version );\r\n\r\n\t// Debug infos\r\n\tif ( WPAC._Options.debug ) {\r\n\t\tif ( ! jQuery || ! jQuery.fn || ! jQuery.fn.jquery ) {\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'error',\r\n\t\t\t\t'jQuery not found, abort initialization. Please try to reinstall the plugin.',\r\n\t\t\t);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tWPAC._Debug( 'info', 'Found jQuery %s', jQuery.fn.jquery );\r\n\t\tif ( ! jQuery.blockUI || ! jQuery.blockUI.version ) {\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'error',\r\n\t\t\t\t'jQuery blockUI not found, abort initialization. Please try to reinstall the plugin.',\r\n\t\t\t);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tWPAC._Debug( 'info', 'Found jQuery blockUI %s', jQuery.blockUI.version );\r\n\t\tif ( ! jQuery.idleTimer ) {\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'error',\r\n\t\t\t\t'jQuery Idle Timer plugin not found, abort initialization. Please try to reinstall the plugin.',\r\n\t\t\t);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tWPAC._Debug( 'info', 'Found jQuery Idle Timer plugin' );\r\n\t}\r\n\r\n\tif ( WPAC._Options.selectorPostContainer ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t\"Multiple comment form support enabled (selector: '%s')\",\r\n\t\t\tWPAC._Options.selectorPostContainer,\r\n\t\t);\r\n\t\tjQuery( WPAC._Options.selectorPostContainer ).each( function( i, e ) {\r\n\t\t\tconst id = jQuery( e ).attr( 'id' );\r\n\t\t\tif ( ! id ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t'Skip post container element %o (ID not defined)',\r\n\t\t\t\t\te,\r\n\t\t\t\t);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tWPAC.AttachForm( {\r\n\t\t\t\tselectorCommentForm: '#' + id + ' ' + WPAC._Options.selectorCommentForm,\r\n\t\t\t\tselectorCommentPagingLinks:\r\n\t\t\t\t\t'#' + id + ' ' + WPAC._Options.selectorCommentPagingLinks,\r\n\t\t\t\tselectorCommentsContainer:\r\n\t\t\t\t\t'#' + id + ' ' + WPAC._Options.selectorCommentsContainer,\r\n\t\t\t\tselectorRespondContainer:\r\n\t\t\t\t\t'#' + id + ' ' + WPAC._Options.selectorRespondContainer,\r\n\t\t\t} );\r\n\t\t} );\r\n\t} else {\r\n\t\tWPAC.AttachForm();\r\n\t}\r\n\r\n\t// Set up loading preview handlers.\r\n\tjQuery( '#wp-admin-bar-wpac-menu-helper-preview-overlay-loading a' ).on(\r\n\t\t'click',\r\n\t\tfunction( e ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tWPAC._ShowMessage( 'This is the loading preview...', 'loadingPreview' );\r\n\t\t},\r\n\t);\r\n\r\n\t// Set up success preview handlers.\r\n\tjQuery( '#wp-admin-bar-wpac-menu-helper-preview-overlay-success a' ).on(\r\n\t\t'click',\r\n\t\tfunction( e ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tWPAC._ShowMessage( 'This is a success message', 'success' );\r\n\t\t},\r\n\t);\r\n\r\n\t// Set up error preview handlers.\r\n\tjQuery( '#wp-admin-bar-wpac-menu-helper-preview-overlay-error a' ).on(\r\n\t\t'click',\r\n\t\tfunction( e ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tWPAC._ShowMessage( 'This is an error message', 'error' );\r\n\t\t},\r\n\t);\r\n\r\n\t// Set up idle timer\r\n\tif ( WPAC._Options.commentsEnabled && WPAC._Options.autoUpdateIdleTime > 0 ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t'Auto updating comments enabled (idle time: %s)',\r\n\t\t\tWPAC._Options.autoUpdateIdleTime,\r\n\t\t);\r\n\t\tWPAC._InitIdleTimer();\r\n\t}\r\n\r\n\tWPAC._Debug( 'info', 'Initialization completed' );\r\n\r\n\treturn true;\r\n};\r\n\r\nWPAC._OnIdle = function() {\r\n\tWPAC.RefreshComments( { success: WPAC._InitIdleTimer, scrollToAnchor: false } );\r\n};\r\n\r\nWPAC._InitIdleTimer = function() {\r\n\tif ( WPAC._TestFallbackUrl( location.href ) ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Fallback URL was detected (url: '%s'), cancel init idle timer\",\r\n\t\t\tlocation.href,\r\n\t\t);\r\n\t\treturn;\r\n\t}\r\n\r\n\tjQuery( document ).idleTimer( 'destroy' );\r\n\tjQuery( document ).idleTimer( WPAC._Options.autoUpdateIdleTime );\r\n\tjQuery( document ).on( 'idle.idleTimer', WPAC._OnIdle );\r\n};\r\n\r\n/**\r\n * Refresh the comments by Ajaxify Comments.\r\n * @param { Object } options Optiosn for Ajaxify Comments.\r\n * @return comments.\r\n */\r\nWPAC.RefreshComments = function( options ) {\r\n\tconst url = location.href;\r\n\tif ( WPAC._TestFallbackUrl( location.href ) ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Fallback URL was detected (url: '%s'), cancel AJAX request\",\r\n\t\t\turl,\r\n\t\t);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Filter the options for Ajaxify Comments.\r\n\t *\r\n\t * @param { Object } options Options for Ajaxify Comments.\r\n\t * @param { string } url     The URL to load.\r\n\t * @param { string } caller  What function called the filter.\r\n\t */\r\n\toptions = wpacHooks.applyFilters(\r\n\t\t'wpacJSOptions',\r\n\t\toptions,\r\n\t\turl,\r\n\t\t'RefreshComments',\r\n\t);\r\n\r\n\t// Users can pass options as first parameter to override selectors.\r\n\treturn WPAC.LoadComments( url, options );\r\n};\r\n\r\nWPAC.LoadComments = function( url, options ) {\r\n\t// Cancel AJAX request if cross-domain scripting is detected\r\n\tif ( WPAC._TestCrossDomainScripting( url ) ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Cross-domain scripting detected (url: '%s'), cancel AJAX request\",\r\n\t\t\turl,\r\n\t\t);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Convert boolean parameter (used in version <0.14.0)\r\n\tif ( typeof options === 'boolean' ) {\r\n\t\toptions = { scrollToAnchor: options };\r\n\t}\r\n\r\n\t// Set default options\r\n\toptions = jQuery.extend(\r\n\t\t{\r\n\t\t\tscrollToAnchor: ! WPAC._Options.disableScrollToAnchor,\r\n\t\t\tshowLoadingInfo: true,\r\n\t\t\tupdateUrl: ! WPAC._Options.disableUrlUpdate,\r\n\t\t\tsuccess() { },\r\n\t\t\tselectorCommentForm: WPAC._Options.selectorCommentForm,\r\n\t\t\tselectorCommentsContainer: WPAC._Options.selectorCommentsContainer,\r\n\t\t\tselectorRespondContainer: WPAC._Options.selectorRespondContainer,\r\n\t\t\tdisableCache: WPAC._Options.disableCache,\r\n\t\t\tbeforeSelectElements: WPACCallbacks.beforeSelectElements,\r\n\t\t\tbeforeUpdateComments: WPACCallbacks.beforeUpdateComments,\r\n\t\t\tafterUpdateComments: WPACCallbacks.afterUpdateComments,\r\n\t\t},\r\n\t\toptions || {},\r\n\t);\r\n\r\n\t/**\r\n\t * Filter the options for Ajaxify Comments.\r\n\t *\r\n\t * @param { Object } options Options for Ajaxify Comments.\r\n\t * @param { string } url     The URL to load.\r\n\t * @param { string } caller  What function called the filter.\r\n\t */\r\n\toptions = wpacHooks.applyFilters(\r\n\t\t'wpacJSOptions',\r\n\t\toptions,\r\n\t\turl,\r\n\t\t'LoadComments',\r\n\t);\r\n\r\n\t// Save form data and focus\r\n\tconst formData = jQuery( options.selectorCommentForm ).serializeArray();\r\n\tconst formFocus = document.activeElement\r\n\t\t? jQuery(\r\n\t\t\t\"[name='\" + document.activeElement.name + \"']\",\r\n\t\t\toptions.selectorCommentForm,\r\n\t\t).attr( 'name' )\r\n\t\t: '';\r\n\r\n\t// Get query strings form URL (ajaxifyLazyLoadEnable, nonce, post_id).\r\n\tconst urlObject = new URL( url );\r\n\tconst queryParams = urlObject.searchParams;\r\n\tconst ajaxifyLazyLoadEnable = queryParams.get( 'ajaxifyLazyLoadEnable' );\r\n\tconst nonce = queryParams.get( 'nonce' );\r\n\tconst postId = queryParams.get( 'post_id' );\r\n\r\n\t// Add to URL.\r\n\turl = WPAC._AddQueryParamStringToUrl(\r\n\t\turl,\r\n\t\t'ajaxifyLazyLoadEnable',\r\n\t\tajaxifyLazyLoadEnable,\r\n\t);\r\n\turl = WPAC._AddQueryParamStringToUrl( url, 'nonce', nonce );\r\n\turl = WPAC._AddQueryParamStringToUrl( url, 'post_id', postId );\r\n\r\n\tif ( options.disableCache ) {\r\n\t\turl = WPAC._AddQueryParamStringToUrl(\r\n\t\t\turl,\r\n\t\t\t'WPACRandom',\r\n\t\t\tnew Date().getTime(),\r\n\t\t);\r\n\t}\r\n\r\n\tconst request = jQuery.ajax( {\r\n\t\turl,\r\n\t\ttype: 'GET',\r\n\t\tbeforeSend( xhr ) {\r\n\t\t\txhr.setRequestHeader( 'X-WPAC-REQUEST', '1' );\r\n\t\t},\r\n\t\tsuccess( data ) {\r\n\t\t\ttry {\r\n\t\t\t\t// Replace comments (and return if replacing failed)\r\n\t\t\t\tif (\r\n\t\t\t\t\t! WPAC._ReplaceComments(\r\n\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\turl,\r\n\t\t\t\t\t\ttrue,\r\n\t\t\t\t\t\tformData,\r\n\t\t\t\t\t\tformFocus,\r\n\t\t\t\t\t\toptions.selectorCommentsContainer,\r\n\t\t\t\t\t\toptions.selectorCommentForm,\r\n\t\t\t\t\t\toptions.selectorRespondContainer,\r\n\t\t\t\t\t\toptions.beforeSelectElements,\r\n\t\t\t\t\t\toptions.beforeUpdateComments,\r\n\t\t\t\t\t\toptions.afterUpdateComments,\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( options.updateUrl ) {\r\n\t\t\t\t\tWPAC._UpdateUrl( url );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Scroll to anchor\r\n\t\t\t\tvar waitForScrollToAnchor = false;\r\n\t\t\t\tif ( options.scrollToAnchor ) {\r\n\t\t\t\t\tconst anchor =\r\n\t\t\t\t\t\turl.indexOf( '#' ) >= 0 ? url.substr( url.indexOf( '#' ) ) : null;\r\n\t\t\t\t\tif ( anchor ) {\r\n\t\t\t\t\t\tWPAC._Debug( 'info', \"Anchor '%s' extracted from url\", anchor );\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tWPAC._ScrollToAnchor( anchor, options.updateUrl, function() {\r\n\t\t\t\t\t\t\t\toptions.success();\r\n\t\t\t\t\t\t\t} )\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\twaitForScrollToAnchor = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch ( e ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'error',\r\n\t\t\t\t\t'Something went wrong while refreshing comments: %s',\r\n\t\t\t\t\te,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// Unblock UI\r\n\t\t\tjQuery.unblockUI();\r\n\r\n\t\t\tif ( ! waitForScrollToAnchor ) {\r\n\t\t\t\toptions.success();\r\n\t\t\t}\r\n\t\t},\r\n\t\terror() {\r\n\t\t\tWPAC._LoadFallbackUrl(\r\n\t\t\t\tWPAC._AddQueryParamStringToUrl(\r\n\t\t\t\t\twindow.location.href,\r\n\t\t\t\t\t'WPACFallback',\r\n\t\t\t\t\t'1',\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t},\r\n\t} );\r\n\r\n\treturn true;\r\n};\r\n\r\njQuery( function() {\r\n\tconst initSuccesful = WPAC.Init();\r\n\tif ( true === WPAC._Options.lazyLoadEnabled ) {\r\n\t\tif ( ! initSuccesful ) {\r\n\t\t\tWPAC._LoadFallbackUrl(\r\n\t\t\t\tWPAC._AddQueryParamStringToUrl(\r\n\t\t\t\t\twindow.location.href,\r\n\t\t\t\t\t'WPACFallback',\r\n\t\t\t\t\t'1',\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst triggerType = WPAC._Options.lazyLoadTrigger;\r\n\r\n\t\tconst lazyLoadTrigger = WPAC._Options.lazyLoadTrigger;\r\n\t\tconst lazyLoadScrollOffset = parseInt(\r\n\t\t\tWPAC._Options.lazyLoadTriggerScrollOffset,\r\n\t\t);\r\n\t\tconst lazyLoadElement = WPAC._Options.lazyLoadTriggerElement;\r\n\t\tlet lazyLoadOffset = parseInt( WPAC._Options.lazyLoadTriggerOffset );\r\n\t\tif ( lazyLoadOffset === 0 ) {\r\n\t\t\tlazyLoadOffset = '100%';\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Filter the offset for lazy loading.\r\n\t\t *\r\n\t\t * @see: http://imakewebthings.com/waypoints/api/offset-option/\r\n\t\t *\r\n\t\t * @param { string } lazyLoadOffset       Offset for lazy loading.\r\n\t\t * @param { string } lazyLoadTrigger      The trigger type for lazy loading.\r\n\t\t * @param { number } lazyLoadScrollOffset The scroll offset for lazy loading.\r\n\t\t * @param { string } lazyLoadElement      The element for lazy loading.\r\n\t\t */\r\n\t\tlazyLoadOffset = wpacHooks.applyFilters(\r\n\t\t\t'wpacLazyLoadOffset',\r\n\t\t\tlazyLoadOffset,\r\n\t\t\tlazyLoadTrigger,\r\n\t\t\tlazyLoadScrollOffset,\r\n\t\t\tlazyLoadElement,\r\n\t\t);\r\n\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t\"Loading comments asynchronously with secondary AJAX request (trigger: '%s')\",\r\n\t\t\tlazyLoadTrigger,\r\n\t\t);\r\n\r\n\t\tif ( window.location.hash ) {\r\n\t\t\tconst regex = /^#comment-[0-9]+$/;\r\n\t\t\tif ( regex.test( window.location.hash ) ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t\"Comment anchor in URL detected, force loading comments on DomReady (hash: '%s')\",\r\n\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t);\r\n\t\t\t\tlazyLoadTrigger = 'domready';\r\n\t\t\t}\r\n\t\t}\r\n\t\tswitch ( lazyLoadTrigger ) {\r\n\t\t\tcase 'external':\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t'Lazy loading: Waiting on external trigger for lazy loading comments.',\r\n\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'comments':\r\n\t\t\t\tconst commentsContainer = document.querySelector(\r\n\t\t\t\t\tWPAC._Options.selectorCommentsContainer,\r\n\t\t\t\t);\r\n\t\t\t\tif ( null !== commentsContainer ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t'Lazy loading: Waiting on comments to scroll into view for lazy loading.',\r\n\t\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tjQuery( commentsContainer ).waypoint(\r\n\t\t\t\t\t\tfunction( direction ) {\r\n\t\t\t\t\t\t\tthis.destroy();\r\n\t\t\t\t\t\t\tWPAC._ShowMessage( WPAC._Options.textRefreshComments, 'loading' );\r\n\t\t\t\t\t\t\tWPAC.RefreshComments();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{ offset: lazyLoadScrollOffset ? lazyLoadScrollOffset : '100%' },\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'error',\r\n\t\t\t\t\t\t'Comments container not found for lazy loading when reaching the comments section.',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'element':\r\n\t\t\t\tconst domElement = document.querySelector( lazyLoadElement );\r\n\t\t\t\tif ( null !== domElement ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t'Lazy loading: Waiting on element to scroll into view for lazy loading.',\r\n\t\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tjQuery( domElement ).waypoint(\r\n\t\t\t\t\t\tfunction( direction ) {\r\n\t\t\t\t\t\t\tthis.destroy();\r\n\t\t\t\t\t\t\tWPAC._ShowMessage( WPAC._Options.textRefreshComments, 'loading' );\r\n\t\t\t\t\t\t\tWPAC.RefreshComments();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{ offset: lazyLoadScrollOffset ? lazyLoadScrollOffset : '100%' },\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'error',\r\n\t\t\t\t\t\t'Element not found for lazy loading when reaching the element.',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'domready':\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t'Lazy loading: Waiting on Dom to be ready for lazy loading.',\r\n\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t);\r\n\t\t\t\tWPAC.RefreshComments( { scrollToAnchor: true } ); // force scroll to anchor.\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'scroll':\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t'Lazy loading: Waiting on Scroll Into View.',\r\n\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Get the body tag and calculate offset.\r\n\t\t\t\tconst body = document.querySelector( 'body' );\r\n\r\n\t\t\t\tjQuery( body ).waypoint(\r\n\t\t\t\t\tfunction( direction ) {\r\n\t\t\t\t\t\tthis.destroy();\r\n\t\t\t\t\t\tWPAC._ShowMessage( WPAC._Options.textRefreshComments, 'loading' );\r\n\t\t\t\t\t\tWPAC.RefreshComments();\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ offset: lazyLoadScrollOffset * -1 },\r\n\t\t\t\t);\r\n\t\t}\r\n\t}\r\n} );\r\n\r\nfunction wpac_init() {\r\n\tWPAC._Debug( 'info', 'wpac_init() is deprecated, please use WPAC.Init()' );\r\n\tWPAC.Init();\r\n}\r\n"],"names":["createHooks","wpacHooks","WPAC","_Options","_BodyRegex","RegExp","_ExtractBody","html","jQuery","exec","e","_TitleRegex","_ExtractTitle","_ShowMessage","message","type","lazyLoadDisplay","lazyLoadEnabled","top","popupMarginTop","outerHeight","backgroundColor","popupBackgroundColorLoading","textColor","popupTextColorLoading","popupBackgroundColorError","popupTextColorError","popupBackgroundColorSuccess","popupTextColorSuccess","blockUI","fadeIn","popupFadeIn","fadeOut","popupFadeOut","timeout","popupTimeout","centerY","centerX","showOverlay","css","width","popupWidth","left","border","padding","popupPadding","popupCornerRadius","opacity","popupOpacity","color","textAlign","popupTextAlign","cursor","popupTextFontSize","overlayCSS","baseZ","popupZindex","_DebugErrorShown","_Debug","level","debug","Function","prototype","call","bind","window","console","_typeof","log","apply","alert","args","merge","makeArray","arguments","slice","_DebugSelector","elementType","selector","optional","element","length","_AddQueryParamStringToUrl","url","param","value","urlObject","URL","queryParams","searchParams","set","search","toString","_LoadFallbackUrl","fallbackUrl","textReloadPage","Date","getTime","reload","location","href","setTimeout","_ScrollToAnchor","anchor","updateHash","scrollComplete","anchorElement","scrollSpeed","animateComplete","hash","scrollTargetTopOffset","offset","scrollTop","animate","duration","complete","_UpdateUrl","split","history","replaceState","document","title","_ReplaceComments","data","commentUrl","useFallbackUrl","formData","formFocus","selectorCommentsContainer","selectorCommentForm","selectorRespondContainer","beforeSelectElements","beforeUpdateComments","afterUpdateComments","oldCommentsContainer","filter","children","is","extractedBody","beforeSelect","beforeSelectEvent","CustomEvent","detail","dispatchEvent","newCommentsContainer","find","beforeComments","beforeCommentsEvent","newDom","extractedTitle","text","replaceWith","commentsEnabled","form","parents","newCommentForm","wpTempFormDiv","newRespondContainer","each","key","formElement","name","val","focus","updateComments","updateCommentsEvent","_TestCrossDomainScripting","indexOf","domain","protocol","host","_TestFallbackUrl","fallbackParam","get","randomParam","AttachForm","options","extend","selectorCommentPagingLinks","WPACCallbacks","beforeSubmitComment","afterPostComment","scrollToAnchor","disableScrollToAnchor","updateUrl","disableUrlUpdate","selectorCommentLinks","applyFilters","dom","on","addHandler","event","handler","delegate","live","pagingClickHandler","attr","preventDefault","LoadComments","linkClickHandler","Uri","formSubmitHandler","beforeSubmit","beforeSubmitEvent","submitUrl","remove","submit","textPostComment","handleErrorResponse","selectorErrorContainer","errorMessage","textUnknownError","request","ajax","serialize","beforeSend","xhr","setRequestHeader","textStatus","removeData","success","getResponseHeader","unapproved","afterComment","afterCommentEvent","textPostedUnapproved","textPosted","wps_launch_confetti_cannon","substr","error","jqXhr","errorThrown","status","responseText","_Initialized","Init","version","fn","jquery","idleTimer","selectorPostContainer","i","id","autoUpdateIdleTime","_InitIdleTimer","_OnIdle","RefreshComments","showLoadingInfo","disableCache","serializeArray","activeElement","ajaxifyLazyLoadEnable","nonce","postId","waitForScrollToAnchor","unblockUI","initSuccesful","triggerType","lazyLoadTrigger","lazyLoadScrollOffset","parseInt","lazyLoadTriggerScrollOffset","lazyLoadElement","lazyLoadTriggerElement","lazyLoadOffset","lazyLoadTriggerOffset","regex","test","_readOnlyError","commentsContainer","querySelector","waypoint","direction","destroy","textRefreshComments","domElement","body","wpac_init"],"sourceRoot":""}