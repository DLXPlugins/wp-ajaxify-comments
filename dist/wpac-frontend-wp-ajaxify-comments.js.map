{"version":3,"file":"wpac-frontend-wp-ajaxify-comments.js","mappings":"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","sources":["webpack://wp-ajaxify-comments/./src/js/frontend/wp-ajaxify-comments.js"],"sourcesContent":["WPAC._Options = WPAC._Options || {};\r\n\r\nWPAC._BodyRegex = new RegExp( '<body[^>]*>((.|\\n|\\r)*)</body>', 'i' );\r\nWPAC._ExtractBody = function( html ) {\r\n\ttry {\r\n\t\treturn jQuery( '<div>' + WPAC._BodyRegex.exec( html )[ 1 ] + '</div>' );\r\n\t} catch ( e ) {\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\nWPAC._TitleRegex = new RegExp( '<title[^>]*>(.*?)<\\\\/title>', 'im' );\r\nWPAC._ExtractTitle = function( html ) {\r\n\ttry {\r\n\t\treturn WPAC._TitleRegex.exec( html )[ 1 ];\r\n\t} catch ( e ) {\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\nWPAC._ShowMessage = function( message, type, force = false ) {\r\n\t// Determine how to display the loading message.\r\n\tconst lazyLoadDisplay = WPAC._Options.lazyLoadDisplay;\r\n\tconst lazyLoadEnabled = WPAC._Options.lazyLoadEnabled;\r\n\r\n\t// Check if lazy load enabled or not.\r\n\tif ( lazyLoadEnabled && 'overlay' !== lazyLoadDisplay && ! force ) {\r\n\t\treturn;\r\n\t}\r\n\tconst top =\r\n\t\tWPAC._Options.popupMarginTop + ( jQuery( '#wpadminbar' ).outerHeight() || 0 );\r\n\r\n\tlet backgroundColor = WPAC._Options.popupBackgroundColorLoading;\r\n\tlet textColor = WPAC._Options.popupTextColorLoading;\r\n\tif ( type == 'error' ) {\r\n\t\tbackgroundColor = WPAC._Options.popupBackgroundColorError;\r\n\t\ttextColor = WPAC._Options.popupTextColorError;\r\n\t} else if ( type == 'success' ) {\r\n\t\tbackgroundColor = WPAC._Options.popupBackgroundColorSuccess;\r\n\t\ttextColor = WPAC._Options.popupTextColorSuccess;\r\n\t}\r\n\r\n\tlet topOffset = WPAC._Options.popupVerticalAlign === 'verticalStart' ? top + 'px' : 'unset';\r\n\tif ( WPAC._Options.popupVerticalAlign === 'verticalCenter' ) {\r\n\t\ttopOffset = '45%';\r\n\t}\r\n\t\r\n\tjQuery.blockUI({ \r\n\t\tblockMsgClass: \"wpac-overlay\",\r\n\t\tmessage: message, \r\n\t\tfadeIn: WPAC._Options.popupFadeIn, \r\n\t\tfadeOut: WPAC._Options.popupFadeOut, \r\n\t\ttimeout:(type == \"loading\") ? 0 : WPAC._Options.popupTimeout, \r\n\t\tcenterY: false,\r\n\t\tcenterX: true,\r\n\t\tshowOverlay: true,\r\n\t\tcss: {\r\n\t\t\twidth: 'var(--wpac-popup-width)',\r\n\t\t\tleft: 'calc(50% - var(--wpac-popup-width) / 2)',\r\n\t\t\ttop: topOffset,\r\n\t\t\tbottom: WPAC._Options.popupVerticalAlign === 'verticalEnd' ? top + 'px' : 'unset',\r\n\t\t\tborder: 'none',\r\n\t\t\tpadding: WPAC._Options.popupPadding + 'px',\r\n\t\t\tbackgroundColor,\r\n\t\t\t'-webkit-border-radius': WPAC._Options.popupCornerRadius + 'px',\r\n\t\t\t'-moz-border-radius': WPAC._Options.popupCornerRadius + 'px',\r\n\t\t\t'border-radius': WPAC._Options.popupCornerRadius + 'px',\r\n\t\t\topacity: WPAC._Options.popupOpacity / 100,\r\n\t\t\tcolor: textColor,\r\n\t\t\ttextAlign: WPAC._Options.popupTextAlign,\r\n\t\t\tcursor:\r\n\t\t\t\ttype == 'loading' || type == 'loadingPreview' ? 'wait' : 'default',\r\n\t\t\t'font-size': WPAC._Options.popupTextFontSize,\r\n\t\t},\r\n\t\toverlayCSS: {\r\n\t\t\tbackgroundColor: WPAC._Options.popupOverlayBackgroundColor,\r\n\t\t\topacity: WPAC._Options.popupOverlayBackgroundColorOpacity,\r\n\t\t},\r\n\t\tbaseZ: WPAC._Options.popupZindex,\r\n\t} );\r\n};\r\n\r\nWPAC._DebugErrorShown = false;\r\nWPAC._Debug = function( level, message ) {\r\n\tif ( ! WPAC._Options.debug ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Fix console.log.apply for IE9\r\n\t// see http://stackoverflow.com/a/5539378/516472\r\n\tif (\r\n\t\tFunction.prototype.call &&\r\n\t\tFunction.prototype.call.bind &&\r\n\t\ttypeof window.console !== 'undefined' &&\r\n\t\tconsole &&\r\n\t\ttypeof console.log === 'object' &&\r\n\t\ttypeof window.console[ level ].apply === 'undefined'\r\n\t) {\r\n\t\tconsole[ level ] = Function.prototype.call.bind( console[ level ], console );\r\n\t}\r\n\r\n\tif (\r\n\t\ttypeof window.console === 'undefined' ||\r\n\t\ttypeof window.console[ level ] === 'undefined' ||\r\n\t\ttypeof window.console[ level ].apply === 'undefined'\r\n\t) {\r\n\t\tif ( ! WPAC._DebugErrorShown ) {\r\n\t\t\talert(\r\n\t\t\t\t'Unfortunately the console object is undefined or is not supported in your browser, debugging WP Ajaxify Comments is disabled! Please use Firebug, Google Chrome or Internet Explorer 9 or above with enabled Developer Tools (F12) for debugging WP Ajaxify Comments.',\r\n\t\t\t);\r\n\t\t}\r\n\t\tWPAC._DebugErrorShown = true;\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst args = jQuery.merge(\r\n\t\t[ '[WP Ajaxify Comments] ' + message ],\r\n\t\tjQuery.makeArray( arguments ).slice( 2 ),\r\n\t);\r\n\tconsole[ level ].apply( console, args );\r\n};\r\n\r\nWPAC._DebugSelector = function( elementType, selector, optional ) {\r\n\tif ( ! WPAC._Options.debug ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst element = jQuery( selector );\r\n\tif ( ! element.length ) {\r\n\t\tWPAC._Debug(\r\n\t\t\toptional ? 'info' : 'error',\r\n\t\t\t\"Search %s (selector: '%s')... Not found\",\r\n\t\t\telementType,\r\n\t\t\tselector,\r\n\t\t);\r\n\t} else {\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t\"Search %s (selector: '%s')... Found: %o\",\r\n\t\t\telementType,\r\n\t\t\tselector,\r\n\t\t\telement,\r\n\t\t);\r\n\t}\r\n};\r\n\r\nWPAC._AddQueryParamStringToUrl = function( url, param, value ) {\r\n\t// Get URL object.\r\n\tconst urlObject = new URL( url );\r\n\r\n\t// Get query params.\r\n\tconst queryParams = urlObject.searchParams;\r\n\r\n\t// Set query param.\r\n\tqueryParams.set( param, value );\r\n\r\n\t// Set query params.\r\n\turlObject.search = queryParams.toString();\r\n\r\n\t// Return URL.\r\n\treturn urlObject.toString();\r\n};\r\n\r\nWPAC._LoadFallbackUrl = function( fallbackUrl ) {\r\n\tWPAC._ShowMessage( WPAC._Options.textReloadPage, 'loading' );\r\n\r\n\tconst url = WPAC._AddQueryParamStringToUrl(\r\n\t\tfallbackUrl,\r\n\t\t'WPACRandom',\r\n\t\tnew Date().getTime(),\r\n\t);\r\n\tWPAC._Debug(\r\n\t\t'info',\r\n\t\t\"Something went wrong. Reloading page (URL: '%s')...\",\r\n\t\turl,\r\n\t);\r\n\r\n\tconst reload = function() {\r\n\t\tlocation.href = url;\r\n\t};\r\n\tif ( ! WPAC._Options.debug ) {\r\n\t\treload();\r\n\t} else {\r\n\t\tWPAC._Debug( 'info', 'Sleep for 5s to enable analyzing debug messages...' );\r\n\t\twindow.setTimeout( reload, 5000 );\r\n\t}\r\n};\r\n\r\nWPAC._ScrollToAnchor = function( anchor, updateHash, scrollComplete ) {\r\n\tscrollComplete = scrollComplete || function() { };\r\n\tconst anchorElement = jQuery( anchor );\r\n\tif ( anchorElement.length ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t'Scroll to anchor element %o (scroll speed: %s ms)...',\r\n\t\t\tanchorElement,\r\n\t\t\tWPAC._Options.scrollSpeed,\r\n\t\t);\r\n\t\tconst animateComplete = function() {\r\n\t\t\tif ( updateHash ) {\r\n\t\t\t\twindow.location.hash = anchor;\r\n\t\t\t}\r\n\t\t\tscrollComplete();\r\n\t\t};\r\n\t\tconst scrollTargetTopOffset = anchorElement.offset().top;\r\n\t\tif ( jQuery( window ).scrollTop() == scrollTargetTopOffset ) {\r\n\t\t\tanimateComplete();\r\n\t\t} else {\r\n\t\t\tjQuery( 'html,body' ).animate(\r\n\t\t\t\t{ scrollTop: scrollTargetTopOffset },\r\n\t\t\t\t{\r\n\t\t\t\t\tduration: WPAC._Options.scrollSpeed,\r\n\t\t\t\t\tcomplete: animateComplete,\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tWPAC._Debug( 'error', \"Anchor element not found (selector: '%s')\", anchor );\r\n\treturn false;\r\n};\r\n\r\nWPAC._UpdateUrl = function( url ) {\r\n\tif ( url.split( '#' )[ 0 ] == window.location.href.split( '#' )[ 0 ] ) {\r\n\t\treturn;\r\n\t}\r\n\tif ( window.history.replaceState ) {\r\n\t\twindow.history.replaceState( {}, window.document.title, url );\r\n\t} else {\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t'Browser does not support window.history.replaceState() to update the URL without reloading the page',\r\n\t\t\tanchor,\r\n\t\t);\r\n\t}\r\n};\r\n\r\nWPAC._ReplaceComments = function(\r\n\tdata,\r\n\tcommentUrl,\r\n\tuseFallbackUrl,\r\n\tformData,\r\n\tformFocus,\r\n\tselectorCommentsContainer,\r\n\tselectorCommentForm,\r\n\tselectorRespondContainer,\r\n\tbeforeSelectElements,\r\n\tbeforeUpdateComments,\r\n\tafterUpdateComments,\r\n) {\r\n\t// Remove any lazy loading messages.\r\n\tjQuery( '#wpac-lazy-load-content-clone' ).remove();\r\n\r\n\tconst fallbackUrl = useFallbackUrl\r\n\t\t? WPAC._AddQueryParamStringToUrl( commentUrl, 'WPACFallback', '1' )\r\n\t\t: commentUrl;\r\n\r\n\tlet oldCommentsContainer = jQuery( selectorCommentsContainer );\r\n\tif ( WPAC._Options.lazyLoadIntoElement && 'comments' !== WPAC._Options.lazyLoadInlineDisplayLocation ) {\r\n\t\toldCommentsContainer = jQuery( WPAC._Options.lazyLoadInlineDisplayElement );\r\n\t}\r\n\tif ( ! oldCommentsContainer.length ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Comment container on current page not found (selector: '%s')\",\r\n\t\t\tselectorCommentsContainer,\r\n\t\t);\r\n\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\treturn false;\r\n\t}\r\n\t// If length is greater than one, there may be greedy selectors.\r\n\tif ( oldCommentsContainer.length > 1 ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Comment form on requested page found multiple times (selector: '%s')\",\r\n\t\t\toldCommentsContainer,\r\n\t\t);\r\n\t\toldCommentsContainer = oldCommentsContainer.filter( function() {\r\n\t\t\treturn jQuery( this ).children().length > 0 && ! jQuery( this ).is( ':header' );\r\n\t\t} );\r\n\t}\r\n\r\n\tconst extractedBody = WPAC._ExtractBody( data );\r\n\tif ( extractedBody === false ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Unsupported server response, unable to extract body (data: '%s')\",\r\n\t\t\tdata,\r\n\t\t);\r\n\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Call before select elements.\r\n\tif ( beforeSelectElements !== '' ) {\r\n\t\tconst beforeSelect = new Function( 'extractedBody', beforeSelectElements );\r\n\t\tbeforeSelect( extractedBody );\r\n\t}\r\n\r\n\t// Set up custom event.\r\n\tconst beforeSelectEvent = new CustomEvent( 'wpacBeforeSelectElements', {\r\n\t\tdetail: { extractedBody },\r\n\t} );\r\n\tdocument.dispatchEvent( beforeSelectEvent );\r\n\r\n\tlet newCommentsContainer = extractedBody.find( selectorCommentsContainer );\r\n\tif ( ! newCommentsContainer.length ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Comment container on requested page not found (selector: '%s')\",\r\n\t\t\tselectorCommentsContainer,\r\n\t\t);\r\n\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\treturn false;\r\n\t}\r\n\tif ( newCommentsContainer.length > 1 ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Comment form on requested page found multiple times (selector: '%s')\",\r\n\t\t\tnewCommentsContainer,\r\n\t\t);\r\n\r\n\t\t// Find the first comment container that has children and is not a heading.\r\n\t\tnewCommentsContainer = newCommentsContainer.filter( function() {\r\n\t\t\treturn jQuery( this ).children().length > 0 && ! jQuery( this ).is( ':header' );\r\n\t\t} );\r\n\r\n\t\t// Find respond selector and remove.\r\n\t\tconst respondContainer = newCommentsContainer.find( selectorRespondContainer );\r\n\t\tif ( respondContainer.length ) {\r\n\t\t\trespondContainer.remove();\r\n\t\t}\r\n\t}\r\n\r\n\t// Call before update comments.\r\n\tif ( '' !== beforeUpdateComments ) {\r\n\t\tconst beforeComments = new Function(\r\n\t\t\t'extractedBody',\r\n\t\t\t'commentUrl',\r\n\t\t\tbeforeUpdateComments,\r\n\t\t);\r\n\t\tbeforeComments( extractedBody, commentUrl );\r\n\t}\r\n\r\n\t// Set up native event handler.\r\n\tconst beforeCommentsEvent = new CustomEvent( 'wpacBeforeUpdateComments', {\r\n\t\tdetail: { newDom: extractedBody, commentUrl },\r\n\t} );\r\n\tdocument.dispatchEvent( beforeCommentsEvent );\r\n\r\n\t// Update title\r\n\tconst extractedTitle = WPAC._ExtractTitle( data );\r\n\tif ( extractedBody !== false ) {\r\n\t\t// Decode HTML entities (see http://stackoverflow.com/a/5796744)\r\n\t\tdocument.title = jQuery( '<textarea />' ).html( extractedTitle ).text();\r\n\t}\r\n\r\n\t// Empty old container, replace with innards of new container.\r\n\toldCommentsContainer.empty();\r\n\toldCommentsContainer.append( newCommentsContainer.children() );\r\n\r\n\tif ( WPAC._Options.commentsEnabled ) {\r\n\t\tconst form = jQuery( selectorCommentForm );\r\n\t\tif ( form.length ) {\r\n\t\t\t// Replace comment form (for spam protection plugin compatibility) if comment form is not nested in comments container\r\n\t\t\t// If comment form is nested in comments container comment form has already been replaced\r\n\t\t\tif ( ! form.parents( selectorCommentsContainer ).length ) {\r\n\t\t\t\tWPAC._Debug( 'info', 'Replace comment form...' );\r\n\t\t\t\tconst newCommentForm = extractedBody.find( selectorCommentForm );\r\n\t\t\t\tif ( newCommentForm.length == 0 ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'error',\r\n\t\t\t\t\t\t\"Comment form on requested page not found (selector: '%s')\",\r\n\t\t\t\t\t\tselectorCommentForm,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tform.replaceWith( newCommentForm );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tWPAC._Debug( 'info', 'Try to re-inject comment form...' );\r\n\r\n\t\t\t// \"Re-inject\" comment form, if comment form was removed by updating the comments container; could happen\r\n\t\t\t// if theme support threaded/nested comments and form tag is not nested in comments container\r\n\t\t\t// -> Replace WordPress placeholder <div> (#wp-temp-form-div) with respond <div>\r\n\t\t\tconst wpTempFormDiv = jQuery( '#wp-temp-form-div' );\r\n\t\t\tif ( ! wpTempFormDiv.length ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'error',\r\n\t\t\t\t\t\"WordPress' #wp-temp-form-div container not found\",\r\n\t\t\t\t\tselectorRespondContainer,\r\n\t\t\t\t);\r\n\t\t\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tconst newRespondContainer = extractedBody.find( selectorRespondContainer );\r\n\t\t\tif ( ! newRespondContainer.length ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'error',\r\n\t\t\t\t\t\"Respond container on requested page not found (selector: '%s')\",\r\n\t\t\t\t\tselectorRespondContainer,\r\n\t\t\t\t);\r\n\t\t\t\tWPAC._LoadFallbackUrl( fallbackUrl );\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\twpTempFormDiv.replaceWith( newRespondContainer );\r\n\t\t}\r\n\r\n\t\tif ( formData ) {\r\n\t\t\t// Re-inject saved form data\r\n\t\t\tjQuery.each( formData, function( key, value ) {\r\n\t\t\t\tconst formElement = jQuery(\r\n\t\t\t\t\t\"[name='\" + value.name + \"']\",\r\n\t\t\t\t\tselectorCommentForm,\r\n\t\t\t\t);\r\n\t\t\t\tif ( formElement.length != 1 || formElement.val() ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tformElement.val( value.value );\r\n\t\t\t} );\r\n\t\t}\r\n\t\tif ( formFocus ) {\r\n\t\t\t// Reset focus\r\n\t\t\tconst formElement = jQuery(\r\n\t\t\t\t\"[name='\" + formFocus + \"']\",\r\n\t\t\t\tselectorCommentForm,\r\n\t\t\t);\r\n\t\t\tif ( formElement ) {\r\n\t\t\t\tformElement.focus();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// Call after update comments.\r\n\tif ( '' !== afterUpdateComments ) {\r\n\t\tconst updateComments = new Function(\r\n\t\t\t'extractedBody',\r\n\t\t\t'commentUrl',\r\n\t\t\tafterUpdateComments,\r\n\t\t);\r\n\t\tupdateComments( extractedBody, commentUrl );\r\n\t}\r\n\t// Set up native event handler.\r\n\tconst updateCommentsEvent = new CustomEvent( 'wpacAfterUpdateComments', {\r\n\t\tdetail: { newDom: extractedBody, commentUrl },\r\n\t} );\r\n\tdocument.dispatchEvent( updateCommentsEvent );\r\n\r\n\treturn true;\r\n};\r\n\r\nWPAC._TestCrossDomainScripting = function( url ) {\r\n\tif ( url.indexOf( 'http' ) != 0 ) {\r\n\t\treturn false;\r\n\t}\r\n\tconst domain = window.location.protocol + '//' + window.location.host;\r\n\treturn url.indexOf( domain ) != 0;\r\n};\r\n\r\nWPAC._TestFallbackUrl = function( url ) {\r\n\t// Get URL object.\r\n\tconst urlObject = new URL( url );\r\n\r\n\t// Get query params.\r\n\tconst queryParams = urlObject.searchParams;\r\n\tconst fallbackParam = queryParams.get( 'WPACFallback' );\r\n\tconst randomParam = queryParams.get( 'WPACRandom' );\r\n\r\n\treturn fallbackParam && randomParam;\r\n};\r\n\r\nWPAC.AttachForm = function( options ) {\r\n\t// Set default options\r\n\toptions = jQuery.extend(\r\n\t\t{\r\n\t\t\tselectorCommentForm: WPAC._Options.selectorCommentForm,\r\n\t\t\tselectorCommentPagingLinks: WPAC._Options.selectorCommentPagingLinks,\r\n\t\t\tbeforeSelectElements: WPACCallbacks.beforeSelectElements,\r\n\t\t\tbeforeSubmitComment: WPACCallbacks.beforeSubmitComment,\r\n\t\t\tafterPostComment: WPACCallbacks.afterPostComment,\r\n\t\t\tselectorCommentsContainer: WPAC._Options.selectorCommentsContainer,\r\n\t\t\tselectorRespondContainer: WPAC._Options.selectorRespondContainer,\r\n\t\t\tbeforeUpdateComments: WPACCallbacks.beforeUpdateComments,\r\n\t\t\tafterUpdateComments: WPACCallbacks.afterUpdateComments,\r\n\t\t\tscrollToAnchor: ! WPAC._Options.disableScrollToAnchor,\r\n\t\t\tupdateUrl: ! WPAC._Options.disableUrlUpdate,\r\n\t\t\tselectorCommentLinks: WPAC._Options.selectorCommentLinks,\r\n\t\t},\r\n\t\toptions || {},\r\n\t);\r\n\r\n\tif ( WPAC._Options.debug && WPAC._Options.commentsEnabled ) {\r\n\t\tWPAC._Debug( 'info', 'Attach form...' );\r\n\t\tWPAC._DebugSelector( 'comment form', options.selectorCommentForm );\r\n\t\tWPAC._DebugSelector(\r\n\t\t\t'comments container',\r\n\t\t\toptions.selectorCommentsContainer,\r\n\t\t);\r\n\t\tWPAC._DebugSelector( 'respond container', options.selectorRespondContainer );\r\n\t\tWPAC._DebugSelector(\r\n\t\t\t'comment paging links',\r\n\t\t\toptions.selectorCommentPagingLinks,\r\n\t\t\ttrue,\r\n\t\t);\r\n\t\tWPAC._DebugSelector( 'comment links', options.selectorCommentLinks, true );\r\n\t}\r\n\r\n\t// Try before submit comment. Using new function is not ideal here, but safer than exec.\r\n\tif ( '' !== WPACCallbacks.beforeSelectElements ) {\r\n\t\tconst beforeSelect = new Function(\r\n\t\t\t'dom',\r\n\t\t\tWPACCallbacks.beforeSelectElements,\r\n\t\t);\r\n\t\tbeforeSelect( jQuery( document ) );\r\n\r\n\t\t// Set up native event handler.\r\n\t\tconst beforeSelectEvent = new CustomEvent( 'wpacBeforeSelectElements', {\r\n\t\t\tdetail: { dom: jQuery( document ) },\r\n\t\t} );\r\n\t\tdocument.dispatchEvent( beforeSelectEvent );\r\n\t}\r\n\r\n\t// Get addHandler method\r\n\tif ( jQuery( document ).on ) {\r\n\t\t// jQuery 1.7+\r\n\t\tvar addHandler = function( event, selector, handler ) {\r\n\t\t\tjQuery( document ).on( event, selector, handler );\r\n\t\t};\r\n\t} else if ( jQuery( document ).delegate ) {\r\n\t\t// jQuery 1.4.3+\r\n\t\tvar addHandler = function( event, selector, handler ) {\r\n\t\t\tjQuery( document ).delegate( selector, event, handler );\r\n\t\t};\r\n\t} else {\r\n\t\t// jQuery 1.3+\r\n\t\tvar addHandler = function( event, selector, handler ) {\r\n\t\t\tjQuery( selector ).live( event, handler );\r\n\t\t};\r\n\t}\r\n\r\n\t// Handle paging link clicks\r\n\tconst pagingClickHandler = function( event ) {\r\n\t\tconst href = jQuery( this ).attr( 'href' );\r\n\t\tif ( href ) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tWPAC.LoadComments( href, {\r\n\t\t\t\tselectorCommentForm: options.selectorCommentForm,\r\n\t\t\t\tselectorCommentsContainer: options.selectorCommentsContainer,\r\n\t\t\t\tselectorRespondContainer: options.selectorRespondContainer,\r\n\t\t\t\tbeforeSelectElements: options.beforeSelectElements,\r\n\t\t\t\tbeforeUpdateComments: options.beforeUpdateComments,\r\n\t\t\t\tafterUpdateComments: options.afterUpdateComments,\r\n\t\t\t} );\r\n\t\t}\r\n\t};\r\n\taddHandler( 'click', options.selectorCommentPagingLinks, pagingClickHandler );\r\n\r\n\t// Handle comment link clicks\r\n\tconst linkClickHandler = function( event ) {\r\n\t\tconst element = jQuery( this );\r\n\t\tif ( element.is( options.selectorCommentPagingLinks ) ) {\r\n\t\t\treturn;\r\n\t\t} // skip if paging link was clicked\r\n\t\tconst href = element.attr( 'href' );\r\n\t\t// To use new URL.\r\n\t\tconst anchor = new URL( href ).hash;\r\n\t\t\r\n\t\tif ( jQuery( anchor ).length > 0 ) {\r\n\t\t\tif ( options.updateUrl ) {\r\n\t\t\t\tWPAC._UpdateUrl( href );\r\n\t\t\t}\r\n\t\t\tWPAC._ScrollToAnchor( anchor, options.updateUrl );\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t};\r\n\taddHandler( 'click', options.selectorCommentLinks, linkClickHandler );\r\n\r\n\tif ( ! WPAC._Options.commentsEnabled ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Handle form submit\r\n\tconst formSubmitHandler = function( event ) {\r\n\t\tconst form = jQuery( this );\r\n\r\n\t\t// Try before submit comment. Using new function is not ideal here, but safer than exec.\r\n\t\tif ( WPACCallbacks.beforeSubmitComment !== '' ) {\r\n\t\t\tconst beforeSubmit = new Function(\r\n\t\t\t\t'dom',\r\n\t\t\t\tWPACCallbacks.beforeSubmitComment,\r\n\t\t\t);\r\n\t\t\tbeforeSubmit( jQuery( document ) );\r\n\r\n\t\t\t// Set up native event handler.\r\n\t\t\tconst beforeSubmitEvent = new CustomEvent( 'wpacBeforeSubmitComment', {\r\n\t\t\t\tdetail: { dom: jQuery( document ) },\r\n\t\t\t} );\r\n\t\t\tdocument.dispatchEvent( beforeSubmitEvent );\r\n\t\t}\r\n\r\n\t\tconst submitUrl = form.attr( 'action' );\r\n\r\n\t\t// Cancel AJAX request if cross-domain scripting is detected\r\n\t\tif ( WPAC._TestCrossDomainScripting( submitUrl ) ) {\r\n\t\t\tif ( WPAC._Options.debug && ! form.data( 'submitCrossDomain' ) ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'error',\r\n\t\t\t\t\t\"Cross-domain scripting detected (submit url: '%s'), cancel AJAX request\",\r\n\t\t\t\t\tsubmitUrl,\r\n\t\t\t\t);\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t'Sleep for 5s to enable analyzing debug messages...',\r\n\t\t\t\t);\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tform.data( 'submitCrossDomain', true );\r\n\t\t\t\twindow.setTimeout( function() {\r\n\t\t\t\t\tjQuery( '#submit', form ).remove();\r\n\t\t\t\t\tform.submit();\r\n\t\t\t\t}, 5000 );\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Stop default event handling\r\n\t\tevent.preventDefault();\r\n\r\n\t\t// Test if form is already submitting\r\n\t\tif ( form.data( 'WPAC_SUBMITTING' ) ) {\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'info',\r\n\t\t\t\t'Cancel submit, form is already submitting (Form: %o)',\r\n\t\t\t\tform,\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tform.data( 'WPAC_SUBMITTING', true );\r\n\r\n\t\t// Show loading info\r\n\t\tWPAC._ShowMessage( WPAC._Options.textPostComment, 'loading', true );\r\n\r\n\t\tconst handleErrorResponse = function( data ) {\r\n\t\t\tWPAC._Debug( 'info', 'Comment has not been posted' );\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'info',\r\n\t\t\t\t\"Try to extract error message (selector: '%s')...\",\r\n\t\t\t\tWPAC._Options.selectorErrorContainer,\r\n\t\t\t);\r\n\r\n\t\t\t// Extract error message\r\n\t\t\tconst extractedBody = WPAC._ExtractBody( data );\r\n\t\t\tif ( extractedBody !== false ) {\r\n\t\t\t\tlet errorMessage = extractedBody.find(\r\n\t\t\t\t\tWPAC._Options.selectorErrorContainer,\r\n\t\t\t\t);\r\n\t\t\t\tif ( errorMessage.length ) {\r\n\t\t\t\t\terrorMessage = errorMessage.html();\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t\"Error message '%s' successfully extracted\",\r\n\t\t\t\t\t\terrorMessage,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tWPAC._ShowMessage( errorMessage, 'error', true );\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'error',\r\n\t\t\t\t\"Error message could not be extracted, use error message '%s'.\",\r\n\t\t\t\tWPAC._Options.textUnknownError,\r\n\t\t\t);\r\n\t\t\tWPAC._ShowMessage( WPAC._Options.textUnknownError, 'error', true );\r\n\t\t};\r\n\r\n\t\tvar request = jQuery.ajax( {\r\n\t\t\turl: submitUrl,\r\n\t\t\ttype: 'POST',\r\n\t\t\tdata: form.serialize(),\r\n\t\t\tbeforeSend( xhr ) {\r\n\t\t\t\txhr.setRequestHeader( 'X-WPAC-REQUEST', '1' );\r\n\t\t\t},\r\n\t\t\tcomplete( xhr, textStatus ) {\r\n\t\t\t\tform.removeData( 'WPAC_SUBMITTING', true );\r\n\t\t\t},\r\n\t\t\tsuccess( data ) {\r\n\t\t\t\t// Test error state (WordPress >=4.1 does not return 500 status code if posting comment failed)\r\n\t\t\t\tif ( request.getResponseHeader( 'X-WPAC-ERROR' ) ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t'Found error state X-WPAC-ERROR header.',\r\n\t\t\t\t\t\tcommentUrl,\r\n\t\t\t\t\t);\r\n\t\t\t\t\thandleErrorResponse( data );\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tWPAC._Debug( 'info', 'Comment has been posted' );\r\n\r\n\t\t\t\t// Get info from response header\r\n\t\t\t\tvar commentUrl = request.getResponseHeader( 'X-WPAC-URL' );\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t\"Found comment URL '%s' in X-WPAC-URL header.\",\r\n\t\t\t\t\tcommentUrl,\r\n\t\t\t\t);\r\n\t\t\t\tconst unapproved = request.getResponseHeader( 'X-WPAC-UNAPPROVED' );\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t\"Found unapproved state '%s' in X-WPAC-UNAPPROVED\",\r\n\t\t\t\t\tunapproved,\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Try afterPostComment submit comment. Using new function is not ideal here, but safer than exec.\r\n\t\t\t\tif ( WPACCallbacks.afterPostComment !== '' ) {\r\n\t\t\t\t\tconst afterComment = new Function( 'commentUrl', 'unapproved', options.afterPostComment);\r\n    \t\t\t\tafterComment( commentUrl, unapproved == '1');\r\n\r\n\t\t\t\t\t// Set up native event handler.\r\n\t\t\t\t\tconst afterCommentEvent = new CustomEvent( 'wpacAfterPostComment', {\r\n\t\t\t\t\t\tdetail: { commentUrl, unapproved: unapproved == '1' },\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tdocument.dispatchEvent( afterCommentEvent );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Show success message\r\n\t\t\t\tWPAC._ShowMessage(\r\n\t\t\t\t\tunapproved == '1'\r\n\t\t\t\t\t\t? WPAC._Options.textPostedUnapproved\r\n\t\t\t\t\t\t: WPAC._Options.textPosted,\r\n\t\t\t\t\t'success',\r\n\t\t\t\t\ttrue\r\n\t\t\t\t);\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * Sunshine Confetti Plugin integration.\r\n\t\t\t\t *\r\n\t\t\t\t * @since 3.0.0\r\n\t\t\t\t *\r\n\t\t\t\t * @see https://wordpress.org/plugins/confetti/\r\n\t\t\t\t */\r\n\t\t\t\tif ( typeof window.wps_launch_confetti_cannon !== 'undefined' ) {\r\n\t\t\t\t\twindow.wps_launch_confetti_cannon();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Replace comments (and return if replacing failed)\r\n\t\t\t\tif (\r\n\t\t\t\t\t! WPAC._ReplaceComments(\r\n\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\tcommentUrl,\r\n\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\t{},\r\n\t\t\t\t\t\t'',\r\n\t\t\t\t\t\toptions.selectorCommentsContainer,\r\n\t\t\t\t\t\toptions.selectorCommentForm,\r\n\t\t\t\t\t\toptions.selectorRespondContainer,\r\n\t\t\t\t\t\toptions.beforeSelectElements,\r\n\t\t\t\t\t\toptions.beforeUpdateComments,\r\n\t\t\t\t\t\toptions.afterUpdateComments,\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Smooth scroll to comment url and update browser url\r\n\t\t\t\tif ( commentUrl ) {\r\n\t\t\t\t\tif ( options.updateUrl ) {\r\n\t\t\t\t\t\tWPAC._UpdateUrl( commentUrl );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( options.scrollToAnchor ) {\r\n\t\t\t\t\t\tconst anchor =\r\n\t\t\t\t\t\t\tcommentUrl.indexOf( '#' ) >= 0\r\n\t\t\t\t\t\t\t\t? commentUrl.substr( commentUrl.indexOf( '#' ) )\r\n\t\t\t\t\t\t\t\t: null;\r\n\t\t\t\t\t\tif ( anchor ) {\r\n\t\t\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t\t\t\"Anchor '%s' extracted from comment URL '%s'\",\r\n\t\t\t\t\t\t\t\tanchor,\r\n\t\t\t\t\t\t\t\tcommentUrl,\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tWPAC._ScrollToAnchor( anchor, options.updateUrl );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror( jqXhr, textStatus, errorThrown ) {\r\n\t\t\t\t// Test if loading comment url failed (due to cross site scripting error)\r\n\t\t\t\tif ( jqXhr.status === 0 && jqXhr.responseText === '' ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'error',\r\n\t\t\t\t\t\t'Comment seems to be posted, but loading comment update failed.',\r\n\t\t\t\t\t);\r\n\t\t\t\t\tWPAC._LoadFallbackUrl(\r\n\t\t\t\t\t\tWPAC._AddQueryParamStringToUrl(\r\n\t\t\t\t\t\t\twindow.location.href,\r\n\t\t\t\t\t\t\t'WPACFallback',\r\n\t\t\t\t\t\t\t'1',\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\thandleErrorResponse( jqXhr.responseText );\r\n\t\t\t},\r\n\t\t} );\r\n\t};\r\n\taddHandler( 'submit', options.selectorCommentForm, formSubmitHandler );\r\n};\r\n\r\nWPAC._Initialized = false;\r\nWPAC.Init = function() {\r\n\t// Test if plugin already has been initialized\r\n\tif ( WPAC._Initialized ) {\r\n\t\tWPAC._Debug( 'info', 'Abort initialization (plugin already initialized)' );\r\n\t\treturn false;\r\n\t}\r\n\tWPAC._Initialized = true;\r\n\r\n\t// Assert that environment is set up correctly\r\n\tif ( ! WPAC._Options || ! WPACCallbacks ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t'Something unexpected happened, initialization failed. Please try to reinstall the plugin.',\r\n\t\t);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Debug infos\r\n\tWPAC._Debug( 'info', 'Initializing version %s', WPAC._Options.version );\r\n\r\n\t// Debug infos\r\n\tif ( WPAC._Options.debug ) {\r\n\t\tif ( ! jQuery || ! jQuery.fn || ! jQuery.fn.jquery ) {\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'error',\r\n\t\t\t\t'jQuery not found, abort initialization. Please try to reinstall the plugin.',\r\n\t\t\t);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tWPAC._Debug( 'info', 'Found jQuery %s', jQuery.fn.jquery );\r\n\t\tif ( ! jQuery.blockUI || ! jQuery.blockUI.version ) {\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'error',\r\n\t\t\t\t'jQuery blockUI not found, abort initialization. Please try to reinstall the plugin.',\r\n\t\t\t);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tWPAC._Debug( 'info', 'Found jQuery blockUI %s', jQuery.blockUI.version );\r\n\t\tif ( ! jQuery.idleTimer ) {\r\n\t\t\tWPAC._Debug(\r\n\t\t\t\t'error',\r\n\t\t\t\t'jQuery Idle Timer plugin not found, abort initialization. Please try to reinstall the plugin.',\r\n\t\t\t);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tWPAC._Debug( 'info', 'Found jQuery Idle Timer plugin' );\r\n\t}\r\n\r\n\tif ( WPAC._Options.selectorPostContainer ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t\"Multiple comment form support enabled (selector: '%s')\",\r\n\t\t\tWPAC._Options.selectorPostContainer,\r\n\t\t);\r\n\t\tjQuery( WPAC._Options.selectorPostContainer ).each( function( i, e ) {\r\n\t\t\tconst id = jQuery( e ).attr( 'id' );\r\n\t\t\tif ( ! id ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t'Skip post container element %o (ID not defined)',\r\n\t\t\t\t\te,\r\n\t\t\t\t);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tWPAC.AttachForm( {\r\n\t\t\t\tselectorCommentForm: '#' + id + ' ' + WPAC._Options.selectorCommentForm,\r\n\t\t\t\tselectorCommentPagingLinks:\r\n\t\t\t\t\t'#' + id + ' ' + WPAC._Options.selectorCommentPagingLinks,\r\n\t\t\t\tselectorCommentsContainer:\r\n\t\t\t\t\t'#' + id + ' ' + WPAC._Options.selectorCommentsContainer,\r\n\t\t\t\tselectorRespondContainer:\r\n\t\t\t\t\t'#' + id + ' ' + WPAC._Options.selectorRespondContainer,\r\n\t\t\t} );\r\n\t\t} );\r\n\t} else {\r\n\t\tWPAC.AttachForm();\r\n\t}\r\n\r\n\t// Set up loading preview handlers.\r\n\tjQuery( '#wp-admin-bar-wpac-menu-helper-preview-overlay-loading a' ).on(\r\n\t\t'click',\r\n\t\tfunction( e ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tWPAC._ShowMessage( 'This is the loading preview...', 'loadingPreview', true );\r\n\t\t},\r\n\t);\r\n\r\n\t// Set up success preview handlers.\r\n\tjQuery( '#wp-admin-bar-wpac-menu-helper-preview-overlay-success a' ).on(\r\n\t\t'click',\r\n\t\tfunction( e ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tWPAC._ShowMessage( 'This is a success message', 'success', true );\r\n\t\t},\r\n\t);\r\n\r\n\t// Set up error preview handlers.\r\n\tjQuery( '#wp-admin-bar-wpac-menu-helper-preview-overlay-error a' ).on(\r\n\t\t'click',\r\n\t\tfunction( e ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tWPAC._ShowMessage( 'This is an error message', 'error', true );\r\n\t\t},\r\n\t);\r\n\r\n\t// Set up idle timer\r\n\tif ( WPAC._Options.commentsEnabled && WPAC._Options.autoUpdateIdleTime > 0 ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t'Auto updating comments enabled (idle time: %s)',\r\n\t\t\tWPAC._Options.autoUpdateIdleTime,\r\n\t\t);\r\n\t\tWPAC._InitIdleTimer();\r\n\t}\r\n\r\n\tWPAC._Debug( 'info', 'Initialization completed' );\r\n\r\n\treturn true;\r\n};\r\n\r\nWPAC._OnIdle = function() {\r\n\tWPAC.RefreshComments( { success: WPAC._InitIdleTimer, scrollToAnchor: false } );\r\n};\r\n\r\nWPAC._InitIdleTimer = function() {\r\n\tif ( WPAC._TestFallbackUrl( location.href ) ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Fallback URL was detected (url: '%s'), cancel init idle timer\",\r\n\t\t\tlocation.href,\r\n\t\t);\r\n\t\treturn;\r\n\t}\r\n\r\n\tjQuery( document ).idleTimer( 'destroy' );\r\n\tjQuery( document ).idleTimer( WPAC._Options.autoUpdateIdleTime );\r\n\tjQuery( document ).on( 'idle.idleTimer', WPAC._OnIdle );\r\n};\r\n\r\n/**\r\n * Refresh the comments by Ajaxify Comments.\r\n * @param { Object } options Optiosn for Ajaxify Comments.\r\n * @return comments.\r\n */\r\nWPAC.RefreshComments = function( options ) {\r\n\r\n\tif ( WPAC._TestFallbackUrl( location.href ) ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Fallback URL was detected (url: '%s'), cancel AJAX request\",\r\n\t\t\tlocation.href,\r\n\t\t);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Users can pass options as first parameter to override selectors.\r\n\treturn WPAC.LoadComments( location.href, options );\r\n};\r\n\r\nWPAC.LoadComments = function( url, options ) {\r\n\t// Cancel AJAX request if cross-domain scripting is detected\r\n\tif ( WPAC._TestCrossDomainScripting( url ) ) {\r\n\t\tWPAC._Debug(\r\n\t\t\t'error',\r\n\t\t\t\"Cross-domain scripting detected (url: '%s'), cancel AJAX request\",\r\n\t\t\turl,\r\n\t\t);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Convert boolean parameter (used in version <0.14.0)\r\n\tif ( typeof options === 'boolean' ) {\r\n\t\toptions = { scrollToAnchor: options };\r\n\t}\r\n\r\n\t// Set default options\r\n\toptions = jQuery.extend(\r\n\t\t{\r\n\t\t\tscrollToAnchor: ! WPAC._Options.disableScrollToAnchor,\r\n\t\t\tshowLoadingInfo: true,\r\n\t\t\tupdateUrl: ! WPAC._Options.disableUrlUpdate,\r\n\t\t\tsuccess() { },\r\n\t\t\tselectorCommentForm: WPAC._Options.selectorCommentForm,\r\n\t\t\tselectorCommentsContainer: WPAC._Options.selectorCommentsContainer,\r\n\t\t\tselectorRespondContainer: WPAC._Options.selectorRespondContainer,\r\n\t\t\tdisableCache: WPAC._Options.disableCache,\r\n\t\t\tbeforeSelectElements: WPACCallbacks.beforeSelectElements,\r\n\t\t\tbeforeUpdateComments: WPACCallbacks.beforeUpdateComments,\r\n\t\t\tafterUpdateComments: WPACCallbacks.afterUpdateComments,\r\n\t\t},\r\n\t\toptions || {},\r\n\t);\r\n\r\n\t// Save form data and focus\r\n\tconst formData = jQuery( options.selectorCommentForm ).serializeArray();\r\n\tconst formFocus = document.activeElement\r\n\t\t? jQuery(\r\n\t\t\t\"[name='\" + document.activeElement.name + \"']\",\r\n\t\t\toptions.selectorCommentForm,\r\n\t\t).attr( 'name' )\r\n\t\t: '';\r\n\r\n\t// Get query strings form URL (ajaxifyLazyLoadEnable, nonce, post_id).\r\n\tconst urlObject = new URL( url );\r\n\tconst queryParams = urlObject.searchParams;\r\n\tif ( queryParams.has( 'ajaxifyLazyLoadEnable' ) ) {\r\n\t\tconst ajaxifyLazyLoadEnable = queryParams.get( 'ajaxifyLazyLoadEnable' );\r\n\t\tconst nonce = queryParams.get( 'nonce' );\r\n\t\tconst postId = queryParams.get( 'post_id' );\r\n\r\n\t\t// Add to URL.\r\n\t\turl = WPAC._AddQueryParamStringToUrl(\r\n\t\t\turl,\r\n\t\t\t'ajaxifyLazyLoadEnable',\r\n\t\t\tajaxifyLazyLoadEnable,\r\n\t\t);\r\n\t\turl = WPAC._AddQueryParamStringToUrl( url, 'nonce', nonce );\r\n\t\turl = WPAC._AddQueryParamStringToUrl( url, 'post_id', postId );\r\n\t}\r\n\r\n\tif ( options.disableCache ) {\r\n\t\turl = WPAC._AddQueryParamStringToUrl(\r\n\t\t\turl,\r\n\t\t\t'WPACRandom',\r\n\t\t\tnew Date().getTime(),\r\n\t\t);\r\n\t}\r\n\r\n\tconst request = jQuery.ajax( {\r\n\t\turl,\r\n\t\ttype: 'GET',\r\n\t\tbeforeSend( xhr ) {\r\n\t\t\txhr.setRequestHeader( 'X-WPAC-REQUEST', '1' );\r\n\t\t},\r\n\t\tsuccess( data ) {\r\n\t\t\ttry {\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t! WPAC._ReplaceComments(\r\n\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\turl,\r\n\t\t\t\t\t\ttrue,\r\n\t\t\t\t\t\tformData,\r\n\t\t\t\t\t\tformFocus,\r\n\t\t\t\t\t\toptions.selectorCommentsContainer,\r\n\t\t\t\t\t\toptions.selectorCommentForm,\r\n\t\t\t\t\t\toptions.selectorRespondContainer,\r\n\t\t\t\t\t\toptions.beforeSelectElements,\r\n\t\t\t\t\t\toptions.beforeUpdateComments,\r\n\t\t\t\t\t\toptions.afterUpdateComments,\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( options.updateUrl ) {\r\n\t\t\t\t\tWPAC._UpdateUrl( url );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Scroll to anchor\r\n\t\t\t\tvar waitForScrollToAnchor = false;\r\n\t\t\t\tif ( options.scrollToAnchor ) {\r\n\t\t\t\t\tconst anchor =\r\n\t\t\t\t\t\turl.indexOf( '#' ) >= 0 ? url.substr( url.indexOf( '#' ) ) : null;\r\n\t\t\t\t\tif ( anchor ) {\r\n\t\t\t\t\t\tWPAC._Debug( 'info', \"Anchor '%s' extracted from url\", anchor );\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tWPAC._ScrollToAnchor( anchor, options.updateUrl, function() {\r\n\t\t\t\t\t\t\t\toptions.success();\r\n\t\t\t\t\t\t\t} )\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\twaitForScrollToAnchor = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch ( e ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'error',\r\n\t\t\t\t\t'Something went wrong while refreshing comments: %s',\r\n\t\t\t\t\te,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// Unblock UI\r\n\t\t\tjQuery.unblockUI();\r\n\r\n\t\t\tif ( ! waitForScrollToAnchor ) {\r\n\t\t\t\toptions.success();\r\n\t\t\t}\r\n\t\t},\r\n\t\terror() {\r\n\t\t\tWPAC._LoadFallbackUrl(\r\n\t\t\t\tWPAC._AddQueryParamStringToUrl(\r\n\t\t\t\t\twindow.location.href,\r\n\t\t\t\t\t'WPACFallback',\r\n\t\t\t\t\t'1',\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t},\r\n\t} );\r\n\r\n\treturn true;\r\n};\r\n\r\njQuery( function() {\r\n\tconst initSuccesful = WPAC.Init();\r\n\tif ( true === WPAC._Options.lazyLoadEnabled ) {\r\n\t\tif ( ! initSuccesful ) {\r\n\t\t\tWPAC._LoadFallbackUrl(\r\n\t\t\t\tWPAC._AddQueryParamStringToUrl(\r\n\t\t\t\t\twindow.location.href,\r\n\t\t\t\t\t'WPACFallback',\r\n\t\t\t\t\t'1',\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst triggerType = WPAC._Options.lazyLoadTrigger;\r\n\r\n\t\tlet lazyLoadTrigger = WPAC._Options.lazyLoadTrigger;\r\n\t\tconst lazyLoadScrollOffset = parseInt(\r\n\t\t\tWPAC._Options.lazyLoadTriggerScrollOffset,\r\n\t\t);\r\n\t\tconst lazyLoadElement = WPAC._Options.lazyLoadTriggerElement;\r\n\t\tconst lazyLoadInlineType = WPAC._Options.lazyLoadInlineLoadingType;\r\n\t\tlet lazyLoadOffset = parseInt( WPAC._Options.lazyLoadTriggerOffset );\r\n\t\tif ( lazyLoadOffset === 0 ) {\r\n\t\t\tlazyLoadOffset = '100%';\r\n\t\t}\r\n\r\n\t\t// Determine where to load the lazy loading message (if not overlay).\r\n\t\tconst isLazyLoadInline = 'inline' === WPAC._Options.lazyLoadDisplay;\r\n\t\tconst lazyloadInlineDisplayLocation = WPAC._Options.lazyLoadInlineDisplayLocation; /* can be comments, element */\r\n\t\t\r\n\r\n\t\t// If inline, let's move the loader.\r\n\t\tif ( isLazyLoadInline && WPAC._Options.lazyLoadIntoElement ) {\r\n\t\t\tlet lazyloadInlineDisplayElement = WPAC._Options.lazyLoadInlineDisplayElement;\r\n\t\t\tif ( 'comments' === lazyloadInlineDisplayLocation ) {\r\n\t\t\t\tlazyloadInlineDisplayElement = WPAC._Options.selectorCommentsContainer;\r\n\t\t\t}\r\n\r\n\t\t\tconst lazyLoadContent = document.querySelector( '#wpac-lazy-load-content' ); // hardcoded selector.\r\n\t\t\tif ( null !== lazyLoadContent ) {\r\n\t\t\t\t// Clone it without ref.\r\n\t\t\t\tconst lazyLoadContentClone = jQuery.clone( lazyLoadContent );\r\n\t\t\t\tlazyLoadContentClone.id = 'wpac-lazy-load-content-clone';\r\n\r\n\r\n\t\t\t\t// Determine trigger if button.\r\n\t\t\t\tif ( 'button' === lazyLoadInlineType ) {\r\n\t\t\t\t\t// This will make it so that a button must be clicked to load comments.\r\n\t\t\t\t\tlazyLoadTrigger = 'external';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( 'skeleton' === lazyLoadInlineType ) {\r\n\t\t\t\t\t// Show the loading skeleton to the user.\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Display the loader.\r\n\t\t\t\tif ( 'comments' === lazyloadInlineDisplayLocation ) {\r\n\t\t\t\t\tconst commentsContainer = jQuery( lazyloadInlineDisplayElement );\r\n\t\t\t\t\tif ( commentsContainer ) {\r\n\r\n\t\t\t\t\t\t// Test for block theme comment container title.\r\n\t\t\t\t\t\tconst maybeBlockCommentstitle = commentsContainer.find( '.wp-block-comments-title, .comments-title' );\r\n\t\t\t\t\t\tif ( maybeBlockCommentstitle.length > 0 ) {\r\n\t\t\t\t\t\t\t// Insert after title.\r\n\t\t\t\t\t\t\tjQuery( maybeBlockCommentstitle ).after( lazyLoadContentClone );\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcommentsContainer.prepend( lazyLoadContentClone );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t\t'error',\r\n\t\t\t\t\t\t\t'Comments container not found for lazy loading when reaching the comments section.',\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if ( 'element' === lazyloadInlineDisplayLocation ) {\r\n\t\t\t\t\tconst domElement = jQuery( lazyloadInlineDisplayElement );\r\n\t\t\t\t\tif ( domElement ) {\r\n\t\t\t\t\t\t// add to top of comments element.\r\n\t\t\t\t\t\tjQuery( domElement ).prepend( lazyLoadContentClone );\r\n\r\n\t\t\t\t\t\t// Remove style attribute.\r\n\t\t\t\t\t\tjQuery( domElement ).removeAttr( 'style' );\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t\t'error',\r\n\t\t\t\t\t\t\t'Element not found for lazy loading when reaching the element.',\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Init lazy loading button (if any).\r\n\t\t\t\tconst lazyLoadButton = document.querySelector( '.ajaxify-comments-loading-button-wrapper button' );\r\n\t\t\t\tif ( null !== lazyLoadButton ) {\r\n\t\t\t\t\tlazyLoadButton.addEventListener( 'click', function( e ) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tlazyLoadButton.innerHTML = WPAC._Options.lazyLoadInlineButtonLabelLoading;\r\n\t\t\t\t\t\tWPAC.RefreshComments();\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tWPAC._Debug(\r\n\t\t\t'info',\r\n\t\t\t\"Loading comments asynchronously with secondary AJAX request (trigger: '%s')\",\r\n\t\t\tlazyLoadTrigger,\r\n\t\t);\r\n\r\n\t\tif ( window.location.hash ) {\r\n\t\t\tconst regex = /^#comment-[0-9]+$/;\r\n\t\t\tif ( regex.test( window.location.hash ) ) {\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t\"Comment anchor in URL detected, force loading comments on DomReady (hash: '%s')\",\r\n\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t);\r\n\t\t\t\tlazyLoadTrigger = 'domready';\r\n\t\t\t}\r\n\t\t}\r\n\t\tswitch ( lazyLoadTrigger ) {\r\n\t\t\tcase 'external':\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t'Lazy loading: Waiting on external trigger for lazy loading comments.',\r\n\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'comments':\r\n\t\t\t\tconst commentsContainer = document.querySelector(\r\n\t\t\t\t\tWPAC._Options.selectorCommentsContainer,\r\n\t\t\t\t);\r\n\t\t\t\tif ( null !== commentsContainer ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t'Lazy loading: Waiting on comments to scroll into view for lazy loading.',\r\n\t\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tjQuery( commentsContainer ).waypoint(\r\n\t\t\t\t\t\tfunction( direction ) {\r\n\t\t\t\t\t\t\tthis.destroy();\r\n\t\t\t\t\t\t\tWPAC._ShowMessage( WPAC._Options.textRefreshComments, 'loading' );\r\n\t\t\t\t\t\t\tWPAC.RefreshComments();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{ offset: lazyLoadScrollOffset ? lazyLoadScrollOffset : '100%' },\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'error',\r\n\t\t\t\t\t\t'Comments container not found for lazy loading when reaching the comments section.',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'element':\r\n\t\t\t\tconst domElement = document.querySelector( lazyLoadElement );\r\n\t\t\t\tif ( null !== domElement ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t'Lazy loading: Waiting on element to scroll into view for lazy loading.',\r\n\t\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tjQuery( domElement ).waypoint(\r\n\t\t\t\t\t\tfunction( direction ) {\r\n\t\t\t\t\t\t\tthis.destroy();\r\n\t\t\t\t\t\t\tif ( 'button' !== lazyLoadInlineType && isLazyLoadInline ) {\r\n\t\t\t\t\t\t\t\tWPAC._ShowMessage( WPAC._Options.textRefreshComments, 'loading' );\r\n\t\t\t\t\t\t\t\tWPAC.RefreshComments();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{ offset: lazyLoadScrollOffset ? lazyLoadScrollOffset : '100%' },\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'error',\r\n\t\t\t\t\t\t'Element not found for lazy loading when reaching the element.',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'domready':\r\n\t\t\t\t// Only refresh comments if not inline button.\r\n\t\t\t\tif ( 'button' !== lazyLoadInlineType && isLazyLoadInline ) {\r\n\t\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t\t'info',\r\n\t\t\t\t\t\t'Lazy loading: Waiting on Dom to be ready for lazy loading.',\r\n\t\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tWPAC._ShowMessage( WPAC._Options.textRefreshComments, 'loading' );\r\n\t\t\t\t\tWPAC.RefreshComments( { scrollToAnchor: true } ); // force scroll to anchor.\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'scroll':\r\n\t\t\t\tWPAC._Debug(\r\n\t\t\t\t\t'info',\r\n\t\t\t\t\t'Lazy loading: Waiting on Scroll Into View.',\r\n\t\t\t\t\twindow.location.hash,\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Get the body tag and calculate offset.\r\n\t\t\t\tconst body = document.querySelector( 'body' );\r\n\r\n\t\t\t\tjQuery( body ).waypoint(\r\n\t\t\t\t\tfunction( direction ) {\r\n\t\t\t\t\t\tthis.destroy();\r\n\t\t\t\t\t\tif ( 'button' !== lazyLoadInlineType && 'inline' === lazyLoadInlineType ) {\r\n\t\t\t\t\t\t\tWPAC._ShowMessage( WPAC._Options.textRefreshComments, 'loading' );\r\n\t\t\t\t\t\t\tWPAC.RefreshComments();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ offset: lazyLoadScrollOffset * -1 },\r\n\t\t\t\t);\r\n\t\t}\r\n\t}\r\n} );\r\n\r\nfunction wpac_init() {\r\n\tWPAC._Debug( 'info', 'wpac_init() is deprecated, please use WPAC.Init()' );\r\n\tWPAC.Init();\r\n}\r\n"],"names":["WPAC","_Options","_BodyRegex","RegExp","_ExtractBody","html","jQuery","exec","e","_TitleRegex","_ExtractTitle","_ShowMessage","message","type","force","arguments","length","undefined","lazyLoadDisplay","lazyLoadEnabled","top","popupMarginTop","outerHeight","backgroundColor","popupBackgroundColorLoading","textColor","popupTextColorLoading","popupBackgroundColorError","popupTextColorError","popupBackgroundColorSuccess","popupTextColorSuccess","topOffset","popupVerticalAlign","blockUI","blockMsgClass","fadeIn","popupFadeIn","fadeOut","popupFadeOut","timeout","popupTimeout","centerY","centerX","showOverlay","css","width","left","bottom","border","padding","popupPadding","popupCornerRadius","opacity","popupOpacity","color","textAlign","popupTextAlign","cursor","popupTextFontSize","overlayCSS","popupOverlayBackgroundColor","popupOverlayBackgroundColorOpacity","baseZ","popupZindex","_DebugErrorShown","_Debug","level","debug","Function","prototype","call","bind","window","console","_typeof","log","apply","alert","args","merge","makeArray","slice","_DebugSelector","elementType","selector","optional","element","_AddQueryParamStringToUrl","url","param","value","urlObject","URL","queryParams","searchParams","set","search","toString","_LoadFallbackUrl","fallbackUrl","textReloadPage","Date","getTime","reload","location","href","setTimeout","_ScrollToAnchor","anchor","updateHash","scrollComplete","anchorElement","scrollSpeed","animateComplete","hash","scrollTargetTopOffset","offset","scrollTop","animate","duration","complete","_UpdateUrl","split","history","replaceState","document","title","_ReplaceComments","data","commentUrl","useFallbackUrl","formData","formFocus","selectorCommentsContainer","selectorCommentForm","selectorRespondContainer","beforeSelectElements","beforeUpdateComments","afterUpdateComments","remove","oldCommentsContainer","lazyLoadIntoElement","lazyLoadInlineDisplayLocation","lazyLoadInlineDisplayElement","filter","children","is","extractedBody","beforeSelect","beforeSelectEvent","CustomEvent","detail","dispatchEvent","newCommentsContainer","find","respondContainer","beforeComments","beforeCommentsEvent","newDom","extractedTitle","text","empty","append","commentsEnabled","form","parents","newCommentForm","replaceWith","wpTempFormDiv","newRespondContainer","each","key","formElement","name","val","focus","updateComments","updateCommentsEvent","_TestCrossDomainScripting","indexOf","domain","protocol","host","_TestFallbackUrl","fallbackParam","get","randomParam","AttachForm","options","extend","selectorCommentPagingLinks","WPACCallbacks","beforeSubmitComment","afterPostComment","scrollToAnchor","disableScrollToAnchor","updateUrl","disableUrlUpdate","selectorCommentLinks","dom","on","addHandler","event","handler","delegate","live","pagingClickHandler","attr","preventDefault","LoadComments","linkClickHandler","formSubmitHandler","beforeSubmit","beforeSubmitEvent","submitUrl","submit","textPostComment","handleErrorResponse","selectorErrorContainer","errorMessage","textUnknownError","request","ajax","serialize","beforeSend","xhr","setRequestHeader","textStatus","removeData","success","getResponseHeader","unapproved","afterComment","afterCommentEvent","textPostedUnapproved","textPosted","wps_launch_confetti_cannon","substr","error","jqXhr","errorThrown","status","responseText","_Initialized","Init","version","fn","jquery","idleTimer","selectorPostContainer","i","id","autoUpdateIdleTime","_InitIdleTimer","_OnIdle","RefreshComments","showLoadingInfo","disableCache","serializeArray","activeElement","has","ajaxifyLazyLoadEnable","nonce","postId","waitForScrollToAnchor","unblockUI","initSuccesful","triggerType","lazyLoadTrigger","lazyLoadScrollOffset","parseInt","lazyLoadTriggerScrollOffset","lazyLoadElement","lazyLoadTriggerElement","lazyLoadInlineType","lazyLoadInlineLoadingType","lazyLoadOffset","lazyLoadTriggerOffset","isLazyLoadInline","lazyloadInlineDisplayLocation","lazyloadInlineDisplayElement","lazyLoadContent","querySelector","lazyLoadContentClone","clone","commentsContainer","maybeBlockCommentstitle","after","prepend","domElement","removeAttr","lazyLoadButton","addEventListener","innerHTML","lazyLoadInlineButtonLabelLoading","regex","test","waypoint","direction","destroy","textRefreshComments","body","wpac_init"],"sourceRoot":""}